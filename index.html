<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Xcel&#039;s Little House</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Xcel&#039;s Little House"><meta name="msapplication-TileImage" content="https://z3.ax1x.com/2021/08/02/f9l1RP.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Xcel&#039;s Little House"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Everything to Discover!"><meta property="og:type" content="blog"><meta property="og:title" content="Xcel&#039;s Little House"><meta property="og:url" content="https://lbn233.github.io/"><meta property="og:site_name" content="Xcel&#039;s Little House"><meta property="og:description" content="Everything to Discover!"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://z3.ax1x.com/2021/08/02/f9l1RP.jpg"><meta property="article:author" content="Xcel"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://z3.ax1x.com/2021/08/02/f9l1RP.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://lbn233.github.io"},"headline":"Xcel's Little House","image":["https://lbn233.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Xcel"},"publisher":{"@type":"Organization","name":"Xcel's Little House","logo":{"@type":"ImageObject","url":{"text":"Xcel's Little House"}}},"description":"Everything to Discover!"}</script><link rel="icon" href="https://z3.ax1x.com/2021/08/02/f9l1RP.jpg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Xcel&#039;s Little House</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/04/About-Dynamic-Point-Segment-Tree/"><img class="fill" src="https://z3.ax1x.com/2021/08/04/fE7tv6.jpg" alt="About Dynamic-Point Segment Tree"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-04T14:40:09.000Z" title="2021/8/4 下午10:40:09">2021-08-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-04T16:48:27.930Z" title="2021/8/5 上午12:48:27">2021-08-05</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">10 minutes read (About 1480 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/04/About-Dynamic-Point-Segment-Tree/">About Dynamic-Point Segment Tree</a></h1><div class="content"><p>自己瞎取的名字，就是动态开点线段树。<br>大概思想当空间不够用的时候，随时可以删点和新建点，比较灵活。<br>下面是几个例子，有的是值域线段树，有的是普通坐标的线段树。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1908">P1908 逆序对</a></li>
</ul>
<p>本来是树状数组水题，现在变成了奇怪的动态开点值域线段树模板题。<br>其实不用值域线段树也可以。<br>普通线段树就要离散化然后按照单调递增的顺序加 value，再 query。<br>多麻烦啊，所以一个值域线段树解决问题。</p>
<p>因为最大值 <code>MAX</code> 为 $10^9$，所以 <code>inf</code> 设为 $10^9$。<br>因为每一次查询的是当前点往右的点数，所以要特判 <code>l&gt;r</code> 的情况。<br>因为 <code>inf=1e9</code>，所以查询 <code>1e9+1</code> 就会炸掉，所以要特判。<br><del>其实把 <code>inf</code> 变成 <code>1e9+10</code> 不是一样的吗</del></p>
<p>那么代码如下。</p>
<p>因为线段树平均链深度为 $\log$ 级别。<br>所以开 $N \log N$ 大小的线段树。<br>动态开点线段树的优势在这道题还真没体现出来（</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e7</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">1e9</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, cnt, root, tree[N];</span><br><span class="line"><span class="keyword">int</span> a[N], ls[N], rs[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> &amp;rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> val, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!rt) rt = ++cnt;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; tree[rt] += f; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (val&lt;=mid) <span class="built_in">upd</span>(ls[rt], l, mid, val, f);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">upd</span>(rs[rt], mid+<span class="number">1</span>, r, val, f);</span><br><span class="line">  tree[rt] = tree[ls[rt]] + tree[rs[rt]];</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!rt) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> tree[rt];</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans += <span class="built_in">query</span>(ls[rt], l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans += <span class="built_in">query</span>(rs[rt], mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n); ll ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> x; <span class="built_in">read</span>(x);</span><br><span class="line">    ans += (ll)<span class="built_in">query</span>(root, <span class="number">1</span>, inf, x+<span class="number">1</span>, inf);</span><br><span class="line">    <span class="built_in">upd</span>(root, <span class="number">1</span>, inf, x, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跑了 4s 多，还不如写普通线段树（bu</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3313">P3313 旅行</a></li>
</ul>
<p>虽然是个紫题，但是是个水紫。</p>
<p>首先问题可以简化成树上染色问题，四个 option 变成下面这样。</p>
<ul>
<li>某个节点被重新染色</li>
<li>节点权值被修改</li>
<li>求路径上某种颜色权值和</li>
<li>求路径上某种颜色最大权值</li>
</ul>
<p>那么考虑对于每一个颜色开一棵动态开点线段树。<br>然后直接树链剖分乱搞。（轻重链剖分）<br>对于 option 3 和 4 随便乱搞都可以过。</p>
<p>但是对于 option 1，可以转化为在树中删点，再丢到另一棵树里。<br>option 2 直接修改当前权值即可。</p>
<p>所以想到 pushup 操作。<br>可以将节点的 MAX 和 SUM 直接变成 0。<br>接着删点（就这么做！）跑路。<br>然后在另一棵树里面新建节点，只需要丢进去即可。<br>然后修改颜色（即要修改节点所属树根）。<br>或者是修改当前的权值。注意要 remove 和 update 之后做。</p>
<p>然后就没了。</p>
<p>似乎并不毒瘤？</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_SIZE = <span class="number">2e7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, Q, cnt, tot<span class="comment">/*build-cnt*/</span>, idx;</span><br><span class="line"><span class="keyword">int</span> w[MAXN], c[MAXN], wl[MAXN], wc[MAXN];</span><br><span class="line"><span class="keyword">int</span> dep[MAXN], siz[MAXN], fa[MAXN], son[MAXN];</span><br><span class="line"><span class="keyword">int</span> tp[MAXN], root[MAXN], id[MAXN];</span><br><span class="line"><span class="keyword">char</span> opt[<span class="number">3</span>]; <span class="keyword">int</span> head[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> to, nxt; &#125; e[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  head[u] = cnt; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  fa[cur] = f, siz[cur] = <span class="number">1</span>;</span><br><span class="line">  dep[cur] = dep[f] + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> heavyson = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to == f) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs1</span>(to, cur), siz[cur] += siz[to];</span><br><span class="line">    <span class="keyword">if</span> (siz[to] &gt; heavyson)</span><br><span class="line">      heavyson = siz[to], son[cur] = to;</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Tp)</span> </span>&#123;</span><br><span class="line">  tp[cur] = Tp, id[cur] = ++idx;</span><br><span class="line">  <span class="keyword">if</span> (!son[cur]) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="built_in">dfs2</span>(son[cur], Tp);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==fa[cur] || to==son[cur]) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(to, to);</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span> &#123;</span> <span class="keyword">int</span> ls, rs, Max, val; &#125; tree[MAX_SIZE];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  tree[rt].val = tree[tree[rt].ls].val + tree[tree[rt].rs].val;</span><br><span class="line">  tree[rt].Max = <span class="built_in">max</span>(tree[tree[rt].ls].Max, tree[tree[rt].rs].Max);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> &amp;rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!rt) rt = ++tot;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; tree[rt].val = tree[rt].Max = W; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (pos&lt;=mid) <span class="built_in">upd</span>(tree[rt].ls, l, mid, pos, W);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">upd</span>(tree[rt].rs, mid+<span class="number">1</span>, r, pos, W);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remv</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; tree[rt].val = tree[rt].Max = <span class="number">0</span>; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (pos&lt;=mid) <span class="built_in">remv</span>(tree[rt].ls, l, mid, pos);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">remv</span>(tree[rt].rs, mid+<span class="number">1</span>, r, pos);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">querys</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> tree[rt].val;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans += <span class="built_in">querys</span>(tree[rt].ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans += <span class="built_in">querys</span>(tree[rt].rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">querym</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> tree[rt].Max;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans = <span class="built_in">max</span>(ans, <span class="built_in">querym</span>(tree[rt].ls, l, mid, L, R));</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans = <span class="built_in">max</span>(ans, <span class="built_in">querym</span>(tree[rt].rs, mid+<span class="number">1</span>, r, L, R));</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qus</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> rel)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    ans += <span class="built_in">querys</span>(root[rel], <span class="number">1</span>, n, id[tp[l]], id[l]);</span><br><span class="line">    l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  ans += <span class="built_in">querys</span>(root[rel], <span class="number">1</span>, n, id[l], id[r]);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qum</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> rel)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    ans = <span class="built_in">max</span>(ans, <span class="built_in">querym</span>(root[rel], <span class="number">1</span>, n, id[tp[l]], id[l]));</span><br><span class="line">    l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  ans = <span class="built_in">max</span>(ans, <span class="built_in">querym</span>(root[rel], <span class="number">1</span>, n, id[l], id[r]));</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(Q);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="built_in">read</span>(w[i]), <span class="built_in">read</span>(c[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> u, v; <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">    <span class="built_in">addEdge</span>(u, v);</span><br><span class="line">    <span class="built_in">addEdge</span>(v, u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="built_in">upd</span>(root[c[i]], <span class="number">1</span>, n, id[i], w[i]);</span><br><span class="line">  <span class="keyword">while</span> (Q--) &#123;</span><br><span class="line">    cin &gt;&gt; opt+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> u, v; <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">    <span class="keyword">if</span> (opt[<span class="number">2</span>] == <span class="string">&#x27;C&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">remv</span>(root[c[u]], <span class="number">1</span>, n, id[u]);</span><br><span class="line">      <span class="built_in">upd</span>(root[v], <span class="number">1</span>, n, id[u], w[u]);</span><br><span class="line">      c[u] = v;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (opt[<span class="number">2</span>] == <span class="string">&#x27;W&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">remv</span>(root[c[u]], <span class="number">1</span>, n, id[u]);</span><br><span class="line">      <span class="built_in">upd</span>(root[c[u]], <span class="number">1</span>, n, id[u], v);</span><br><span class="line">      w[u] = v;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (opt[<span class="number">2</span>] == <span class="string">&#x27;S&#x27;</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">qus</span>(u, v, c[u]));</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (opt[<span class="number">2</span>] == <span class="string">&#x27;M&#x27;</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">qum</span>(u, v, c[u]));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/04/CF961G-Solution/"><img class="fill" src="https://z3.ax1x.com/2021/08/04/fkHeaj.jpg" alt="CF961G Solution"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-04T04:35:39.000Z" title="2021/8/4 下午12:35:39">2021-08-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-04T16:52:50.098Z" title="2021/8/5 上午12:52:50">2021-08-05</time></span><span class="level-item"><a class="link-muted" href="/categories/Sol/">Sol</a></span><span class="level-item">10 minutes read (About 1456 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/04/CF961G-Solution/">CF961G Solution</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF961G">CF961G Partitions</a></li>
</ul>
<p>这题好神啊 … 我发现我一直 WA5 的原因是开始统计和的时候没有取模（<br>然后就想着写篇题解记录一下 …</p>
<p>首先题目不是要求一个和吗。</p>
<p>那么通过人类智慧发现很显然所有数出现的次数都是一样的。<br>也就是说最后的和式必然是 $…\times \sum\limits_{i=1}^nw_i$ 这样的形式。</p>
<p>那么不妨将前面的系数设为 $p$。</p>
<p>我们对于这个问题其实可以用 DP 的思想来解决。<br>我们对于求整个柿子的系数，直接考虑枚举子集大小。<br>然后就可以发现我们当前选了 $i$ 个，然后算出自己集合的方案和别的集合的方案即可。<br>最后相乘累加就是答案，其中运用的是第二类斯特林数的思想。</p>
<p>第二类斯特林数就解决的是这样一类问题：</p>
<ul>
<li>$n$ 个物品放入 $m$ 个不同集合中，求集合非空的总方案数。</li>
</ul>
<p>想要研究的同学可以自行研究，这里不再赘述。</p>
<p>所以就可以得到系数 $p$ 变成了下面的柿子。</p>
<p>$$p=\sum\limits_{i=1}^ni\binom{n-1}{i-1}S_2(n-i,k-1)$$<br>$$=\sum\limits_{i=1}^ni\binom{n-1}{i-1}\dfrac{1}{(k-1)!}\sum\limits_{j=0}^{k-1}(-1)^j\binom{k-1}{j}(k-j-1)^{n-i}$$<br>$$=\sum\limits_{i=1}^ni\binom{n-1}{i-1}\dfrac{1}{(k-1)!}\sum\limits_{j=0}^{k-1}(-1)^j\dfrac{(k-1)!}{j!\times(k-j-1)!}(k-j-1)^{n-i}$$<br>$$=\sum\limits_{i=1}^ni\binom{n-1}{i-1}\sum\limits_{j=0}^{k-1}\dfrac{(-1)^j(k-j-1)^{n-i}}{j!\times(k-j-1)!}$$<br>$$=\sum\limits_{j=0}^{k-1}\dfrac{(-1)^j}{j!\times(k-j-1)!}\sum\limits_{i=1}^ni\binom{n-1}{i-1}(k-j-1)^{n-i}$$</p>
<p>注意上面将 $j$ 的和式提前了，这显然是正确的。<br>因为分母相同相加分母不变，然后 $-1$ 的系数显然只和 $j$ 有关。<br>但是分子剩下的部分 $(k-j-1)^{n-i}$ 显然和 $i$ 和 $j$ 都有关。<br>所以为了方便后面的推导，这里直接将 $j$ 提前作为后面那一堆和的系数。<br>这里说的 <strong>方便推导</strong> 其实也没有什么非常清晰的界定，只是这部分可以简单解决。<br>当然不排除有暴力老哥直接卷的情况。（<br>其实我也不知道可不可以卷，因为我没学多项式（（</p>
<p>所以看到一大堆阶乘，在保证答案正确性的情况下，直接从一大堆柿子里面拎出来是必要的。</p>
<p>然后后面那个 $(k-j-1)$ 看起来特别丑，弄成 $s$。</p>
<p>$$\sum\limits_{i=1}^ni\binom{n-1}{i-1}s^{n-i}$$<br>$$=\sum\limits_{i=1}^ni\times s^{n-i}\dfrac{(n-1)!}{(i-1)! \times (n-i)!}$$</p>
<p>为了约分上面的组合数拆开了。</p>
<p>然后有一个 trick，<br>看到分母有一个 $i-1$，看到前面的系数 $i$，<br>所以把那个 $i$ 给拆掉，拆成 $i=i-1+1$。</p>
<p>所以有</p>
<p>$$=\sum\limits_{i=1}^ns^{n-i}\times(i-1+1)\dfrac{(n-1)!}{(i-1)! \times (n-i)!}$$<br>$$=\sum\limits_{i=1}^ns^{n-i}[(i-1)\times \dfrac{(n-1)!}{(i-1)! \times (n-i)!}+\dfrac{(n-1)!}{(i-1)! \times (n-i)!}]$$<br>$$=\sum\limits_{i=1}^ns^{n-i}(i-1)\dfrac{(n-1)!}{(i-1)! \times (n-i)!}+\sum\limits_{i=1}^ns^{n-i}\dfrac{(n-1)!}{(i-1)! \times (n-i)!}$$</p>
<p>然后约掉共同的 $i-1$。</p>
<p>$$=\sum\limits_{i=1}^ns^{n-i}\dfrac{(n-1)!}{(i-2)! \times (n-i)!}+\sum\limits_{i=1}^n\dfrac{(n-1)!}{(i-1)! \times (n-i)!}$$</p>
<p>再重新写成方便的组合数形式。</p>
<p>$$=\sum\limits_{i=1}^ns^{n-i}\binom{n-1}{i-2}+\sum_{i=1}^ns^{n-i}\binom{n-1}{i-1}$$</p>
<p>由于这个上下不统一所以把 $(n-1)$ 提出来。</p>
<p>$$=(n-1)\sum\limits_{i=1}^ns^{n-i}\binom{n-2}{i-2}+\sum\limits_{i=1}^ns^{n-i}\binom{n-1}{i-1}$$</p>
<p>然后发现这个玩意儿好像很不好算，<br>所以变成下面这样，因为 $\binom{n}{m}=\binom{n}{n-m}$。</p>
<p>$$=(n-1)\sum\limits_{i=1}^ns^{n-i}\binom{n-2}{n-i}+\sum\limits_{i=1}^ns^{n-i}\binom{n-1}{n-i}$$</p>
<p>然后根据那个什么柿子的展开，就是杨辉三角的系数，<br>观察到 $n-i$ 的共同部分可以运用上这个公式，<br>可以发现这个可以直接把组合数拆开变成幂。</p>
<p>实际上那个 $\sum\limits_{i=1}^n$ 有一些项应该是不能算的，因为组合数其实等于 $0$。<br>所以根据 $(a+b)^n$ 的系数其实就是组合数，可以直接代进去。</p>
<p>即 $(a+b)^n=\sum\limits_{i=0}^n\binom{n}{i}a^{n-i}b^i$。</p>
<p>应该长成这样吧，不太确定有没有问题。</p>
<p>所以又可以化简成下面那样。</p>
<p>$$=(n-1)(s+1)^{n-2}+(s+1)^{n-1}$$<br>$$=(s+1)^{n-2}(s+1+n-1)$$<br>$$=(s+1)^{n-2}(s+n)$$</p>
<p>然后就可以代回去了。</p>
<p>$$p=\sum\limits_{j=0}^{k-1}\dfrac{(-1)^j}{j!\times(k-j-1)!}[(n-1)(k-j)^{n-2}+(k-j)^{n-1}]$$<br>$$=\sum\limits_{j=0}^{k-1}\dfrac{(-1)^j}{j!\times(k-j-1)!}(k-j)^{n-2}(n+k-j-1)$$</p>
<p>所以就可以得出代码了。<br>我的时间复杂度比较劣，代码还是参考别人的吧。</p>
<p>时间复杂度 $\Theta(k \log \text{Mod})$。</p>
<p>不要问我为什么后面是 $\text{Mod}$ 而不是 $n$（<br>问就是逆元没有线性求，直接 <code>qpow(x,mod-2)</code>（（（</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> n, k, cnt, sum, a, jc[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  jc[<span class="number">0</span>] = jc[<span class="number">1</span>] = <span class="number">1ll</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>; i&lt;=k; ++i)</span><br><span class="line">    jc[i] = jc[i<span class="number">-1</span>] * i % MOD;</span><br><span class="line">    <span class="comment">// 预处理阶乘</span></span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> bas, <span class="keyword">int</span> pw)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> mult = <span class="number">1ll</span>;</span><br><span class="line">  <span class="keyword">while</span> (pw) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pw &amp; <span class="number">1ll</span>) mult = mult * bas % MOD;</span><br><span class="line">    bas = bas * bas % MOD;</span><br><span class="line">    pw /= <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 貌似是个 UB，不能写 &gt;&gt;=1ll</span></span><br><span class="line">  &#125; <span class="keyword">return</span> mult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">inv</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">qpow</span>(x, MOD<span class="number">-2</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//   freopen(&quot;sum.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="comment">// freopen(&quot;sum.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;n, &amp;k); <span class="built_in">init</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;a), cnt = (cnt + a) % MOD;</span><br><span class="line">  <span class="keyword">int</span> Sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;k; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = <span class="built_in">inv</span>(jc[i]);</span><br><span class="line">    cur = cur * <span class="built_in">inv</span>(jc[k-i<span class="number">-1</span>]) % MOD;</span><br><span class="line">    <span class="keyword">int</span> f = i&amp;<span class="number">1</span>? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">    cur = f * cur % MOD, cur = (cur % MOD + MOD) % MOD;</span><br><span class="line">    cur = cur * <span class="built_in">qpow</span>(k-i, n<span class="number">-2</span>) % MOD;</span><br><span class="line">    cur = cur * (n+k-i<span class="number">-1</span>) % MOD;</span><br><span class="line">    Sum = (Sum + cur) % MOD;</span><br><span class="line">    <span class="comment">// 对于分母求逆元再乘分子，基本操作</span></span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; Sum * cnt % MOD &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/04/P2150-Solution/"><img class="fill" src="https://z3.ax1x.com/2021/08/04/fkZXin.jpg" alt="P2150 Solution"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-04T01:13:40.000Z" title="2021/8/4 上午9:13:40">2021-08-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-04T16:52:43.069Z" title="2021/8/5 上午12:52:43">2021-08-05</time></span><span class="level-item"><a class="link-muted" href="/categories/Sol/">Sol</a></span><span class="level-item">9 minutes read (About 1326 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/04/P2150-Solution/">P2150 Solution</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2150">P2150 寿司晚宴</a></li>
</ul>
<h3 id="Simplification-for-the-Question"><a href="#Simplification-for-the-Question" class="headerlink" title="Simplification for the Question"></a>Simplification for the Question</h3><ul>
<li>有 $[2,n]$ 总共 $n-1$ 个数。</li>
<li>从中挑选一些不重复的数字（可以不全选），组成集合 $S$ 和 $T$。</li>
<li>求使得 $\forall x \in S,y \in T,\gcd(x,y)=1$ 的方案总数。</li>
</ul>
<hr>
<h2 id="Part-1-30pts-Algorithm"><a href="#Part-1-30pts-Algorithm" class="headerlink" title="Part 1 - 30pts Algorithm"></a>Part 1 - 30pts Algorithm</h2><p>首先看到最简单的 30pts 算法，最暴力的部分总能给我们启示。</p>
<p>对于这 30pts，观察到 $n \le 30$。</p>
<p>那么这意味着什么呢？对，就是暴力。</p>
<p>首先看到 $\gcd$，求最大公约数，由唯一分解定理可知每一个数都可以由若干质数或质数的幂的连乘积构成，那么显然问题转化为：求使得 $\forall x\in S,y \in T$，设 $x$ 包含的质数集合为 $P$，设 $y$ 包含的质数集合为 $P’$，有 $P∩P’=\varnothing$，像这样的方案总数。</p>
<p>由于一个数的整数因数一定 $\le$ 它本身，所以说最大的质数一定 $\le n$，即 $p \le n \le 30$。<br>其中 $p$ 表示当前情况的质数集合。</p>
<p>很显然，经过枚举，我们发现 $30$ 以内有 $10$ 个质数（</p>
<p>所以直接暴力状压 DP，将质数的包含情况作为状态，包含为 $1$，否则为 $0$。</p>
<p>那么这个就是 30pts 的暴力算法了，时间复杂度 $\Theta(2^{2p}N)$，其中 $p$ 为质数个数。</p>
<hr>
<h2 id="Part-2-pts-Algorithm"><a href="#Part-2-pts-Algorithm" class="headerlink" title="Part 2 - ? pts Algorithm"></a>Part 2 - ? pts Algorithm</h2><p>我也不知道中间那两档分是用来干什么的。<br>所以直接看正解算了吧。/kel</p>
<hr>
<h2 id="Part-3-100pts-Algorithm"><a href="#Part-3-100pts-Algorithm" class="headerlink" title="Part 3 - 100pts Algorithm"></a>Part 3 - 100pts Algorithm</h2><p>首先我们判一个数是否是质数，最暴力的是这样判的。</p>
<ul>
<li>试除法</li>
</ul>
<p>大概就长这样</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">function</span> (<span class="keyword">int</span> n)</span><br><span class="line"><span class="keyword">if</span> n:<span class="number">0</span> / n:<span class="number">1</span> -&gt; <span class="built_in">back</span>(<span class="number">0</span>)</span><br><span class="line"><span class="function"><span class="keyword">for</span> i in <span class="title">range</span><span class="params">(<span class="number">2</span>,sqrt(n))</span></span></span><br><span class="line"><span class="function">  <span class="keyword">if</span> !<span class="params">(n mod i)</span> -&gt; <span class="title">back</span><span class="params">(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">back</span><span class="params">(<span class="number">1</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>那么看到这个 $\sqrt{n}$，这个就是解题的重点。</p>
<p>首先 $\sqrt{n} \times \sqrt{n}=n$。</p>
<p>接着，分两种情况讨论质数 $p$。</p>
<ul>
<li>$p\ge\sqrt{n}$</li>
</ul>
<p>那么设 $p \times k=n$，则显然 $k \le \sqrt{n}$。</p>
<p>又因为因数不大于这个数本身，所以 $\ge\sqrt{n}$ 的数最多只有两个，即 $&gt;\sqrt{n}$ 的数最多只有一个。</p>
<ul>
<li>$p&lt;\sqrt{n}$</li>
</ul>
<p>这个不用讲了吧。</p>
<p>那么又看到我们之前的暴力。</p>
<p>我们搞暴力，就是处理 $20$ 以内的质数。</p>
<p>但是现在我们发现 $&gt;\sqrt{n}$ 的数最多只有一个，那么只要处理 $\le \sqrt{n}$ 的数，并且新开一个记录这个 $&gt;\sqrt{n}$ 的数即可。</p>
<p>然后我们又看到 $n \le 500$。</p>
<p>而 $\sqrt{500}=22.360679775…$</p>
<p>所以说这个暴力就是个铺垫嘛，处理 $22$ 反而只有八个质数。</p>
<p>所以我们就想到了正解，也就是，同样枚举八个质数的情况，然后再根据大质数来判断是否可选即可。</p>
<p>但是我们怎么能保证大质数呢？</p>
<p>很显然，直接大质数从小到大结构体排个序即可。<br>然后对于两个人取的 DP 数，直接暴力处理然后合并即可。</p>
<p>注意合并的时候要容斥，因为统计会同时处理两个人都不选的情况，所以在合并的时候要减掉一个原来的数值。</p>
<p>恭喜你，你又 A 掉了一道黑题。</p>
<p>时间复杂度优化为恒定 $\Theta(2^{16}N)$</p>
<p>其中有一个地方要注意一下，就是在判断一开始预处理的质数情况时，贡献一定要加到对面去而不是自己的地方，因为如果加到自己的地方，无法保证对面和自己没有重复的元素，但是因为我们已经判断过这个质数和自己的关系，所以即使这个质数情况与对面有重复，加到一起仍然与自己合法，因为一定不会有重复的地方。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ri register int</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e2</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1</span>&lt;&lt;<span class="number">8</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> pr[<span class="number">8</span>] = &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> n, Mod, dp[M][M];</span><br><span class="line"><span class="keyword">int</span> Mer1[M][M], Mer2[M][M];</span><br><span class="line"><span class="comment">// Merge after dealing with, to DP</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Number</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> value;</span><br><span class="line">  <span class="keyword">int</span> MaxiPrime;</span><br><span class="line">  <span class="keyword">int</span> OtherPrime;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dealwith</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// deal with possible primes</span></span><br><span class="line">    <span class="keyword">int</span> cur = value;</span><br><span class="line">    <span class="keyword">for</span> (ri i=<span class="number">0</span>; i&lt;<span class="number">8</span>; ++i) &#123;</span><br><span class="line">      <span class="comment">// choose the primes</span></span><br><span class="line">      <span class="keyword">if</span> (cur % pr[i]) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="comment">// can&#x27;t be devided with no left</span></span><br><span class="line">      OtherPrime |= (<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">      <span class="keyword">while</span> (!(cur % pr[i])) cur /= pr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cur &gt; <span class="number">1</span>) MaxiPrime = cur;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> Number &amp;X) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> MaxiPrime &lt; X.MaxiPrime;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(Mod);</span><br><span class="line">  <span class="keyword">for</span> (ri i=<span class="number">2</span>; i&lt;=n; ++i)</span><br><span class="line">    a[i<span class="number">-1</span>].value = i, a[i<span class="number">-1</span>].<span class="built_in">dealwith</span>();</span><br><span class="line">  <span class="built_in">sort</span>(a+<span class="number">1</span>, a+n), dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Merge</span><span class="params">(ri &amp;x, ri y)</span> </span>&#123;</span><br><span class="line">  x = (x + y) % Mod;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">init</span>();</span><br><span class="line">  <span class="comment">// predict:</span></span><br><span class="line">    <span class="comment">// Rolling Array, Back-to-Head Scan!</span></span><br><span class="line">  <span class="keyword">for</span> (ri i=<span class="number">1</span>; i&lt;n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">1</span> || a[i].MaxiPrime ^ a[i<span class="number">-1</span>].MaxiPrime || !a[i].MaxiPrime)</span><br><span class="line">      <span class="built_in">memcpy</span>(Mer1, dp, <span class="keyword">sizeof</span> Mer1),</span><br><span class="line">      <span class="built_in">memcpy</span>(Mer2, dp, <span class="keyword">sizeof</span> Mer2);</span><br><span class="line">    <span class="comment">// just copy from dp to Merge</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ri j=M<span class="number">-1</span>; j&gt;=<span class="number">0</span>; --j)</span><br><span class="line">      <span class="keyword">for</span> (ri k=M<span class="number">-1</span>; k&gt;=<span class="number">0</span>; --k) &#123;</span><br><span class="line">        <span class="comment">// enumarate each possible situation</span></span><br><span class="line">        <span class="comment">// which is of the two people</span></span><br><span class="line">        <span class="keyword">if</span> (j&amp;k) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">// has the same elements</span></span><br><span class="line">        <span class="keyword">if</span> (!(j&amp;a[i].OtherPrime))</span><br><span class="line">          <span class="built_in">Merge</span>(Mer1[j][k|a[i].OtherPrime], Mer1[j][k]);</span><br><span class="line">        <span class="keyword">if</span> (!(k&amp;a[i].OtherPrime))</span><br><span class="line">          <span class="built_in">Merge</span>(Mer2[j|a[i].OtherPrime][k], Mer2[j][k]);</span><br><span class="line">          # 需要注意的就是这里，不要写反了</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (i == n<span class="number">-1</span> || a[i].MaxiPrime ^ a[i+<span class="number">1</span>].MaxiPrime || !a[i].MaxiPrime)</span><br><span class="line">      <span class="keyword">for</span> (ri j=<span class="number">0</span>; j&lt;M; ++j)</span><br><span class="line">        <span class="keyword">for</span> (ri k=<span class="number">0</span>; k&lt;M; ++k) &#123;</span><br><span class="line">          <span class="keyword">if</span> (j&amp;k) <span class="keyword">continue</span>;</span><br><span class="line">          <span class="comment">// has the same elements</span></span><br><span class="line">          ri to = Mer1[j][k] + Mer2[j][k] - dp[j][k];</span><br><span class="line">          to %= Mod, dp[j][k] = to;</span><br><span class="line">          dp[j][k] = (dp[j][k] + Mod) % Mod;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ri ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (ri i=<span class="number">0</span>; i&lt;M; ++i)</span><br><span class="line">    <span class="keyword">for</span> (ri j=<span class="number">0</span>; j&lt;M; ++j)</span><br><span class="line">      <span class="keyword">if</span> (!(i&amp;j)) <span class="built_in">Merge</span>(ans, dp[i][j]);</span><br><span class="line">  cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/03/System-of-Difference-Constraints/"><img class="fill" src="https://z3.ax1x.com/2021/08/03/fFGQtU.jpg" alt="差分约束重提"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-03T14:34:50.000Z" title="2021/8/3 下午10:34:50">2021-08-03</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-03T15:02:33.405Z" title="2021/8/3 下午11:02:33">2021-08-03</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">2 minutes read (About 371 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/03/System-of-Difference-Constraints/">差分约束重提</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5960">P5960 差分约束算法</a></li>
</ul>
<p>显然题。</p>
<p>首先有 $x_{c1}-x_{c1’} \le y_1$。<br>那么有 $x_{c1} \le x_{c1’} + y_1$。<br>所以看到图论里面的松弛操作，即最终使得 <code>dist[to]&lt;=dist[cur]+e[i].val</code>。</p>
<p>要使得这个成立所以要跑一遍最短路。</p>
<p>那么将 $x$ 视为 <code>dist</code>，<code>c1</code> 视为 <code>to</code>，<code>c1&#39;</code> 视为 <code>cur</code> 即可。</p>
<p>然后因为跑最短路的 dijkstra 需要源点，即单源最短路径。<br>所以直接造一个源点就可以跑了，并没有什么实际作用（</p>
<p>判负环似乎只需要加上一个统计入队次数的 cnt 即可。<br>因为显然，有负环就没有合法解。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, cnt; <span class="keyword">bool</span> inq[N];</span><br><span class="line"><span class="keyword">int</span> head[N&lt;&lt;<span class="number">1</span>], dist[N], vis[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to, nxt, val;</span><br><span class="line">&#125; e[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  e[cnt].val = w; head[u] = cnt;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  queue &lt;<span class="keyword">int</span>&gt; sp; sp.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">  vis[<span class="number">0</span>] = <span class="number">1</span>, inq[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">  <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dist);</span><br><span class="line">  dist[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (!sp.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = sp.<span class="built_in">front</span>(); sp.<span class="built_in">pop</span>();</span><br><span class="line">    inq[cur] = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; ~i; i=e[i].nxt) &#123;</span><br><span class="line">      <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">      <span class="keyword">if</span> (dist[to] &gt; dist[cur]+e[i].val) &#123;</span><br><span class="line">        dist[to] = dist[cur] + e[i].val;</span><br><span class="line">        <span class="keyword">if</span> (!inq[to]) &#123;</span><br><span class="line">          inq[to] = <span class="literal">true</span>, sp.<span class="built_in">push</span>(to);</span><br><span class="line">          ++vis[to]; <span class="keyword">if</span> (vis[to]&gt;n) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head);</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> u, v, w; cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;</span><br><span class="line">    <span class="built_in">addEdge</span>(v, u, w);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">addEdge</span>(<span class="number">0</span>, i, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">spfa</span>()) &#123; <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>); <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) cout &lt;&lt; dist[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/03/DS-On-Tree/"><img class="fill" src="https://z3.ax1x.com/2021/08/03/fiaTSS.jpg" alt="DS On Tree"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-03T08:56:16.000Z" title="2021/8/3 下午4:56:16">2021-08-03</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-03T12:02:44.212Z" title="2021/8/3 下午8:02:44">2021-08-03</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">17 minutes read (About 2585 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/03/DS-On-Tree/">DS On Tree</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3384">P3384 轻重链剖分</a></li>
</ul>
<p>显然的板子题。  </p>
<p>那么我们只需要干这样一件事情，就是按照重儿子的顺序来进行 DFS，那么这样我们就可以通过 DFS 序这样一个东西来进行子树的查询和更改，同时也可以通过跳链顶，类似 LCA 的操作，来进行路径的修改和查询。这都非常容易实现。</p>
<p>同时有几个我容易犯错的地方。</p>
<ol>
<li>树剖几大毒瘤问题</li>
</ol>
<ul>
<li><p><code>if(dep[tp[l]] &lt; dep[tp[r]]) swap(l, r);</code><br>这个很显然，因为树剖是按照 <code>tp-&gt;node</code> 的顺序所以是 <code>tp</code> 来 <code>swap</code>。</p>
</li>
<li><p><code>upd(1, 1, n, id[tp[l]], id[l], f);</code><br>我也不知道我为什么 <code>id[l]</code> 能够写成 <code>tp[l]</code>。</p>
</li>
<li><p>搞线段树的时候要注意 pushdown 的灵活变通，不要把修改值弄成了加法和乘法。</p>
</li>
</ul>
<p>所以代码会长下面这样。<br>顺带一提，这是我重写了几万遍之后确定的样式。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, root, Mod, cnt, idx;</span><br><span class="line"><span class="keyword">int</span> w[N], wl[N], val[N&lt;&lt;<span class="number">2</span>], head[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> dep[N], id[N], fa[N], son[N];</span><br><span class="line"><span class="keyword">int</span> lazy[N&lt;&lt;<span class="number">2</span>], tp[N], siz[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to, nxt;</span><br><span class="line">&#125; e[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  head[u] = cnt; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls ((rt)&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs ((rt)&lt;&lt;1|1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  val[rt] = (val[ls] + val[rs]) % Mod;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; val[rt] = wl[l]; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">build</span>(ls, l, mid);</span><br><span class="line">  <span class="built_in">build</span>(rs, mid+<span class="number">1</span>, r);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!lazy[rt]) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  lazy[ls] += lazy[rt], lazy[rs] += lazy[rt];</span><br><span class="line">  lazy[ls] %= Mod, lazy[rs] %= Mod;</span><br><span class="line">  val[ls] = (val[ls] + (mid-l+<span class="number">1</span>) * lazy[rt]) % Mod;</span><br><span class="line">  val[rs] = (val[rs] + (r-mid) * lazy[rt]) % Mod;</span><br><span class="line">  lazy[rt] = <span class="number">0</span>; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) &#123;</span><br><span class="line">    val[rt] += (r-l+<span class="number">1</span>) * f, val[rt] %= Mod;</span><br><span class="line">    lazy[rt] += f, lazy[rt] %= Mod;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">pushdown</span>(rt, l, r);</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) <span class="built_in">upd</span>(ls, l, mid, L, R, f);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) <span class="built_in">upd</span>(rs, mid+<span class="number">1</span>, r, L, R, f);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> val[rt];</span><br><span class="line">  <span class="built_in">pushdown</span>(rt, l, r);</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans += <span class="built_in">query</span>(ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans += <span class="built_in">query</span>(rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">return</span> ans % Mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  dep[cur] = dep[f] + <span class="number">1</span>;</span><br><span class="line">  siz[cur] = <span class="number">1</span>, fa[cur] = f;</span><br><span class="line">  <span class="keyword">int</span> heavyson = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==f) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs1</span>(to, cur), siz[cur] += siz[to];</span><br><span class="line">    <span class="keyword">if</span> (siz[to]&gt;heavyson)</span><br><span class="line">      heavyson = siz[to], son[cur] = to;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Tp)</span> </span>&#123;</span><br><span class="line">  id[cur] = ++idx, wl[idx] = w[cur];</span><br><span class="line">  tp[cur] = Tp; <span class="keyword">if</span> (!son[cur]) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="built_in">dfs2</span>(son[cur], Tp);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==son[cur] || to==fa[cur]) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(to, to);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  f %= Mod;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[tp[l]], id[l], f);</span><br><span class="line">    l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[l], id[r], f);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qu</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    ans = (ans + <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[tp[l]], id[l])) % Mod;</span><br><span class="line">    l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  ans = (ans + <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[l], id[r])) % Mod;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upsub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> f)</span> </span>&#123; <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[x], id[x]+siz[x]<span class="number">-1</span>, f); &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qusub</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[x], id[x]+siz[x]<span class="number">-1</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">  <span class="built_in">read</span>(root), <span class="built_in">read</span>(Mod);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(w[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> u, v; <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">    <span class="built_in">addEdge</span>(u, v);</span><br><span class="line">    <span class="built_in">addEdge</span>(v, u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">dfs1</span>(root, root);</span><br><span class="line">  <span class="built_in">dfs2</span>(root, <span class="number">0</span>); <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">  <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, x, y, z;</span><br><span class="line">    <span class="built_in">read</span>(opt);</span><br><span class="line">    <span class="keyword">if</span> (opt==<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">read</span>(x), <span class="built_in">read</span>(y), <span class="built_in">read</span>(z);</span><br><span class="line">      <span class="built_in">up</span>(x, y, z);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (opt==<span class="number">2</span>) &#123;</span><br><span class="line">      <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">qu</span>(x, y) % Mod);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (opt==<span class="number">3</span>) &#123;</span><br><span class="line">      <span class="built_in">read</span>(x), <span class="built_in">read</span>(z);</span><br><span class="line">      <span class="built_in">upsub</span>(x, z);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="built_in">read</span>(x); <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">qusub</span>(x) % Mod); &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2590">P2590 树的统计</a></li>
</ul>
<p>更简单了，甚至不需要 <code>lazytag</code>。</p>
<p>代码如下。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> isdigit(ch) (ch&gt;47&amp;&amp;ch&lt;58)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch ^ <span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch == <span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">out</span><span class="params">(<span class="keyword">int</span> ret)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (ret&lt;<span class="number">0</span>) &#123; ret = -ret, <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>); &#125;</span><br><span class="line">  <span class="keyword">if</span> (ret&gt;<span class="number">9</span>) <span class="built_in">out</span>(ret/<span class="number">10</span>);</span><br><span class="line">  <span class="built_in">putchar</span>(ret%<span class="number">10</span> ^ <span class="number">48</span>); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">3e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, Q, cnt, dfn;</span><br><span class="line"><span class="keyword">int</span> w[N], v[N], head[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> val[N&lt;&lt;<span class="number">2</span>], siz[N], Maxi[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> id[N], fa[N], tp[N], son[N], dep[N];</span><br><span class="line"><span class="keyword">char</span> str[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> x&gt;y? x:y; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> &amp;y)</span> </span>&#123; x ^= y ^= x ^= y; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to, nxt;</span><br><span class="line">&#125; e[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls ((rt)&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs ((rt)&lt;&lt;1|1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  head[u] = cnt;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  val[rt] = val[ls] + val[rs];</span><br><span class="line">  Maxi[rt] = <span class="built_in">max</span>(Maxi[ls], Maxi[rs]);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l == r) &#123; val[rt] = Maxi[rt] = v[l]; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">build</span>(ls, l, mid);</span><br><span class="line">  <span class="built_in">build</span>(rs, mid+<span class="number">1</span>, r);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l == r) &#123; val[rt] = Maxi[rt] = f; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (pos&lt;=mid) <span class="built_in">upd</span>(ls, l, mid, pos, f);</span><br><span class="line">  <span class="keyword">if</span> (pos&gt;mid) <span class="built_in">upd</span>(rs, mid+<span class="number">1</span>, r, pos, f);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">querys</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> val[rt];</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans += <span class="built_in">querys</span>(ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans += <span class="built_in">querys</span>(rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">querym</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> Maxi[rt];</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, Max = <span class="number">-1e9</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) Max = <span class="built_in">max</span>(Max, <span class="built_in">querym</span>(ls, l, mid, L, R));</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) Max = <span class="built_in">max</span>(Max, <span class="built_in">querym</span>(rs, mid+<span class="number">1</span>, r, L, R));</span><br><span class="line">  <span class="keyword">return</span> Max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Fa)</span> </span>&#123;</span><br><span class="line">  dep[cur] = dep[Fa] + <span class="number">1</span>;</span><br><span class="line">  fa[cur] = Fa, siz[cur] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> heavyson = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to == Fa) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs1</span>(to, cur);</span><br><span class="line">    siz[cur] += siz[to];</span><br><span class="line">    <span class="keyword">if</span> (siz[to] &gt; heavyson)</span><br><span class="line">      son[cur] = to, heavyson = siz[to];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Tp)</span> </span>&#123;</span><br><span class="line">  id[cur] = ++dfn;</span><br><span class="line">  v[dfn] = w[cur], tp[cur] = Tp;</span><br><span class="line">  <span class="keyword">if</span> (!son[cur]) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="built_in">dfs2</span>(son[cur], Tp);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to == fa[cur] || to == son[cur]) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(to, to);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qus</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="keyword">int</span> cur = <span class="built_in">querys</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[tp[l]], id[l]);</span><br><span class="line">    ans += cur, l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  ans += <span class="built_in">querys</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[l], id[r]);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qum</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">-1e9</span>;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="keyword">int</span> cur = <span class="built_in">querym</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[tp[l]], id[l]);</span><br><span class="line">    ans = <span class="built_in">max</span>(ans, cur), l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  ans = <span class="built_in">max</span>(ans, <span class="built_in">querym</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[l], id[r]));</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//   freopen(&quot;P2590.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line"><span class="comment">//   freopen(&quot;P2590.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">  <span class="built_in">read</span>(n);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> x, y; <span class="built_in">read</span>(x), <span class="built_in">read</span>(y);</span><br><span class="line">    <span class="built_in">addEdge</span>(x, y), <span class="built_in">addEdge</span>(y, x);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(w[i]);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">read</span>(Q);</span><br><span class="line">  <span class="keyword">while</span> (Q--) &#123;</span><br><span class="line">    std::cin &gt;&gt; str+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> l, r; <span class="built_in">read</span>(l), <span class="built_in">read</span>(r);</span><br><span class="line">    <span class="keyword">if</span> (str[<span class="number">1</span>] == <span class="string">&#x27;C&#x27;</span>) <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[l], r);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (str[<span class="number">2</span>] == <span class="string">&#x27;M&#x27;</span>) <span class="built_in">out</span>(<span class="built_in">qum</span>(l, r)), <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (str[<span class="number">2</span>] == <span class="string">&#x27;S&#x27;</span>) <span class="built_in">out</span>(<span class="built_in">qus</span>(l, r)), <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2146">P2146 软件包管理器</a></li>
</ul>
<p>简单 trick。</p>
<p>只需要将依赖关系转化为树上关系就可以了。<br>然后就是要区分 <code>0</code> 和 <code>unedited</code>，完全不一样。<br>所以可以直接将 <code>unedited</code> 设置为 <code>-1</code> 然后乱搞即可。</p>
<p>注意是赋值而不是加法。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, Q, cnt, idx, head[N];</span><br><span class="line"><span class="keyword">int</span> val[N&lt;&lt;<span class="number">2</span>], lazy[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> id[N], tp[N], siz[N], dep[N];</span><br><span class="line"><span class="keyword">char</span> opt[<span class="number">20</span>]; <span class="keyword">int</span> fa[N], son[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> to, nxt; &#125; e[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  head[u] = cnt; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls ((rt)&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs ((rt)&lt;&lt;1|1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  val[rt] = val[ls] + val[rs];</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (lazy[rt]&lt;<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  lazy[ls] = lazy[rt], lazy[rs] = lazy[rt];</span><br><span class="line">  val[ls] = lazy[rt] * (mid-l+<span class="number">1</span>);</span><br><span class="line">  val[rs] = lazy[rt] * (r-mid);</span><br><span class="line">  lazy[rt] = <span class="number">-1</span>; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) &#123;</span><br><span class="line">    lazy[rt] = f; val[rt] = f * (r-l+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">pushdown</span>(rt, l, r);</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) <span class="built_in">upd</span>(ls, l, mid, L, R, f);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) <span class="built_in">upd</span>(rs, mid+<span class="number">1</span>, r, L, R, f);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> val[rt];</span><br><span class="line">  <span class="built_in">pushdown</span>(rt, l, r);</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans += <span class="built_in">query</span>(ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans += <span class="built_in">query</span>(rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  dep[cur] = dep[f] + <span class="number">1</span>;</span><br><span class="line">  fa[cur] = f, siz[cur] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> heavyson = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="built_in">dfs1</span>(to, cur), siz[cur] += siz[to];</span><br><span class="line">    <span class="keyword">if</span> (siz[to] &gt; heavyson)</span><br><span class="line">      heavyson = siz[to], son[cur] = to;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Tp)</span> </span>&#123;</span><br><span class="line">  id[cur] = ++idx; tp[cur] = Tp;</span><br><span class="line">  <span class="keyword">if</span> (!son[cur]) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="built_in">dfs2</span>(son[cur], Tp);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==son[cur]) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(to, to);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[tp[l]], id[l], f);</span><br><span class="line">    l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[l], id[r], f);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//   freopen(&quot;P2146.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="built_in">memset</span>(lazy, <span class="number">-1</span>, <span class="keyword">sizeof</span> lazy);</span><br><span class="line">  <span class="built_in">read</span>(n);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> v; <span class="built_in">read</span>(v);</span><br><span class="line">    <span class="built_in">addEdge</span>(v+<span class="number">1</span>, i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="built_in">read</span>(Q);</span><br><span class="line">  <span class="keyword">while</span> (Q--) &#123;</span><br><span class="line">    cin &gt;&gt; opt+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> v; <span class="built_in">read</span>(v); ++v;</span><br><span class="line">    <span class="keyword">int</span> cur = <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">if</span> (opt[<span class="number">1</span>]==<span class="string">&#x27;i&#x27;</span>) <span class="built_in">up</span>(<span class="number">1</span>, v, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (opt[<span class="number">1</span>]==<span class="string">&#x27;u&#x27;</span>) <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[v], id[v]+siz[v]<span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> to = <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, <span class="number">1</span>, n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">abs</span>(cur-to));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3178">P3178 树上操作</a></li>
</ul>
<p>也是个简单题，就是不要被 <code>from</code> 和 <code>to</code> 骗了，双向边肯定要连的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, cnt, idx;</span><br><span class="line"><span class="keyword">int</span> dep[N], son[N], fa[N], siz[N];</span><br><span class="line"><span class="keyword">int</span> head[N&lt;&lt;<span class="number">1</span>], tp[N], w[N], wl[N], id[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> to, nxt; &#125; e[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  head[u] = cnt; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> lazy[N&lt;&lt;<span class="number">2</span>], val[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls ((rt)&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs ((rt)&lt;&lt;1|1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  val[rt] = val[ls] + val[rs];</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; val[rt] = wl[l]; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">build</span>(ls, l, mid);</span><br><span class="line">  <span class="built_in">build</span>(rs, mid+<span class="number">1</span>, r);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!lazy[rt]) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  lazy[ls] += lazy[rt], lazy[rs] += lazy[rt];</span><br><span class="line">  val[ls] += (mid-l+<span class="number">1</span>) * lazy[rt];</span><br><span class="line">  val[rs] += (r-mid) * lazy[rt];</span><br><span class="line">  lazy[rt] = <span class="number">0</span>; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) &#123; lazy[rt] += f; val[rt] += f * (r-l+<span class="number">1</span>); <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>; <span class="built_in">pushdown</span>(rt, l, r);</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) <span class="built_in">upd</span>(ls, l, mid, L, R, f);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) <span class="built_in">upd</span>(rs, mid+<span class="number">1</span>, r, L, R, f);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> val[rt];</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>, mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">pushdown</span>(rt, l, r);</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans += <span class="built_in">query</span>(ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans += <span class="built_in">query</span>(rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  fa[cur] = f, siz[cur] = <span class="number">1</span>;</span><br><span class="line">  dep[cur] = dep[f] + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> heavyson = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==f) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs1</span>(to, cur); siz[cur] += siz[to];</span><br><span class="line">    <span class="keyword">if</span> (siz[to] &gt; heavyson)</span><br><span class="line">      heavyson = siz[to], son[cur] = to;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Tp)</span> </span>&#123;</span><br><span class="line">  id[cur] = ++idx, wl[idx] = w[cur];</span><br><span class="line">  tp[cur] = Tp;</span><br><span class="line">  <span class="keyword">if</span> (!son[cur]) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="built_in">dfs2</span>(son[cur], Tp);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==fa[cur] || to==son[cur]) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(to, to);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">que</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    ans += <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[tp[l]], id[l]);</span><br><span class="line">    l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  ans += <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[l], id[r]);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(w[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> u, v; <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">    <span class="built_in">addEdge</span>(u, v);</span><br><span class="line">    <span class="built_in">addEdge</span>(v, u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">  <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, x, a; <span class="built_in">read</span>(opt), <span class="built_in">read</span>(x);</span><br><span class="line">    <span class="keyword">if</span> (opt==<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">read</span>(a);</span><br><span class="line">      <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[x], id[x], a);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (opt==<span class="number">2</span>) &#123;</span><br><span class="line">      <span class="built_in">read</span>(a);</span><br><span class="line">      <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, id[x], id[x]+siz[x]<span class="number">-1</span>, a);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">que</span>(<span class="number">1</span>, x));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/02/Kill-Network-Flows/"><img class="fill" src="https://z3.ax1x.com/2021/08/02/fCU13Q.png" alt="Kill Network-Flows"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-02T15:12:29.000Z" title="2021/8/2 下午11:12:29">2021-08-02</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-04T09:18:35.801Z" title="2021/8/4 下午5:18:35">2021-08-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">19 minutes read (About 2826 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/02/Kill-Network-Flows/">Kill Network-Flows</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2756">P2756 飞行员配对方案问题</a></li>
</ul>
<p>只要默认前面 $m$ 个都是外国的，然后剩下的都是英国的，接着暴力建图跑 Dinic 即可。<br>貌似只需要弄一个源点 $0$ 和汇点 $n+1$ 即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> head[N], dep[N];</span><br><span class="line"><span class="keyword">bool</span> vis[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to, nxt, val;</span><br><span class="line">&#125; e[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  e[cnt].val = w;</span><br><span class="line">  head[u] = cnt; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=n+<span class="number">1</span>; ++i) dep[i] = <span class="number">0</span>;</span><br><span class="line">  dep[<span class="number">0</span>] = <span class="number">2</span>; queue &lt;<span class="keyword">int</span>&gt; sp; sp.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">while</span> (!sp.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = sp.<span class="built_in">front</span>(); sp.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">      <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">      <span class="keyword">if</span> (!dep[to] &amp;&amp; e[i].val) &#123;</span><br><span class="line">        dep[to] = dep[cur] + <span class="number">1</span>, sp.<span class="built_in">push</span>(to);</span><br><span class="line">        <span class="keyword">if</span> (to==n+<span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Max)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (cur==n+<span class="number">1</span>) <span class="keyword">return</span> Max;</span><br><span class="line">  <span class="keyword">int</span> increase = Max;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i&amp;&amp;increase; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (e[i].val &amp;&amp; dep[to]==dep[cur]+<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> res = <span class="built_in">dfs</span>(to, <span class="built_in">min</span>(increase, e[i].val));</span><br><span class="line">      e[i].val -= res, e[i^<span class="number">1</span>].val += res;</span><br><span class="line">      <span class="keyword">if</span> (!res) dep[to] = <span class="number">0</span>;</span><br><span class="line">      increase -= res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Max-increase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(m), <span class="built_in">read</span>(n);</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">int</span> u, v; <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">    <span class="keyword">if</span> (u==<span class="number">-1</span> &amp;&amp; v==<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">addEdge</span>(u, v, inf);</span><br><span class="line">    <span class="built_in">addEdge</span>(v, u, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; ++i)</span><br><span class="line">    <span class="built_in">addEdge</span>(<span class="number">0</span>, i, <span class="number">1</span>), <span class="built_in">addEdge</span>(i, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=m+<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="built_in">addEdge</span>(i, n+<span class="number">1</span>, <span class="number">1</span>), <span class="built_in">addEdge</span>(n+<span class="number">1</span>, i, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span>(<span class="built_in">check</span>()) ans += <span class="built_in">dfs</span>(<span class="number">0</span>, inf);</span><br><span class="line">  cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>; i&lt;=cnt; i+=<span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!e[i^<span class="number">1</span>].val) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> (!e[i].to || !e[i^<span class="number">1</span>].to) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> (e[i].to==n+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> (e[i^<span class="number">1</span>].to==n+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, e[i^<span class="number">1</span>].to, e[i].to);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1251">P1251 餐巾计划问题</a></li>
</ul>
<p>这道题最重要的是连边。<br>那么很显然的拆点技巧，将一天拆成服务和收工两个点，即 <code>i+N</code> 和 <code>i</code>，后前两个点。<br>那么源点为 <code>0</code>，汇点为 <code>2*N+1</code>。</p>
<ul>
<li>要购买餐巾</li>
</ul>
<p>显然从源点处购买，直接建边 <code>add(0,i+N,inf,p)</code>。</p>
<ul>
<li>偷懒先不洗餐巾</li>
</ul>
<p>显然直接延到下一天，<code>add(i,i+1,inf,0)</code>。</p>
<ul>
<li>快洗</li>
</ul>
<p>显然直接丢到 $m$ 天后，<code>add(i,i+N+m,inf,f)</code>。</p>
<ul>
<li>慢洗</li>
</ul>
<p>同理丢到 $n$ 天后，<code>add(i,i+N+n,inf,s)</code>。</p>
<p>然后每一天要跑至少为 <code>r[i]</code> 的流量，直接源点连收工，汇点连服务。</p>
<p>然后跑一遍最小费用最大流即可。</p>
<p>nt 的地方：DFS 要标记 <code>cur</code>，数组不要开小。<br>要是写对了正解然后数组开小了那就真的是个 zz。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">2e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N, cnt = <span class="number">1</span>, head[MAXN*<span class="number">12</span>];</span><br><span class="line"><span class="keyword">int</span> p, m, f, n, s, dist[MAXN*<span class="number">12</span>];</span><br><span class="line"><span class="keyword">bool</span> inq[MAXN*<span class="number">2</span>], vis[MAXN*<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> cost;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to, nxt, flow, val;</span><br><span class="line">&#125; e[MAXN*<span class="number">12</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> f, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  e[cnt].flow = f, e[cnt].val = w;</span><br><span class="line">  head[u] = cnt;</span><br><span class="line"></span><br><span class="line">  e[++cnt].to = u;</span><br><span class="line">  e[cnt].nxt = head[v];</span><br><span class="line">  e[cnt].flow = <span class="number">0</span>, e[cnt].val = -w;</span><br><span class="line">  head[v] = cnt; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=<span class="number">2</span>*N+<span class="number">1</span>; ++i)</span><br><span class="line">    dist[i] = inf, inq[i] = <span class="literal">false</span>;</span><br><span class="line">  dist[<span class="number">0</span>] = <span class="number">0</span>, inq[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">  queue &lt;<span class="keyword">int</span>&gt; sp; sp.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">while</span> (!sp.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = sp.<span class="built_in">front</span>(); sp.<span class="built_in">pop</span>();</span><br><span class="line">    inq[cur] = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">      <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">      <span class="keyword">if</span> (e[i].flow &amp;&amp; dist[to]&gt;dist[cur]+e[i].val) &#123;</span><br><span class="line">        dist[to] = dist[cur] + e[i].val;</span><br><span class="line">        <span class="keyword">if</span> (!inq[to]) inq[to] = <span class="literal">true</span>, sp.<span class="built_in">push</span>(to);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dist[<span class="number">2</span>*N+<span class="number">1</span>] &lt; inf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Max)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (cur == <span class="number">2</span>*N+<span class="number">1</span>) &#123; vis[cur] = <span class="literal">true</span>; <span class="keyword">return</span> Max; &#125;</span><br><span class="line">  <span class="keyword">int</span> increase = Max; vis[cur] = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i &amp;&amp; increase; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> ((!vis[to] || to==MAXN) &amp;&amp; e[i].flow &amp;&amp; dist[to]==dist[cur]+e[i].val) &#123;</span><br><span class="line">      <span class="keyword">int</span> res = <span class="built_in">dfs</span>(to, <span class="built_in">min</span>(increase, e[i].flow));</span><br><span class="line">      <span class="keyword">if</span> (!res) <span class="keyword">continue</span>;</span><br><span class="line">      e[i].flow -= res, e[i^<span class="number">1</span>].flow += res;</span><br><span class="line">      cost += res * e[i].val, increase -= res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Max-increase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  cin &gt;&gt; N;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=N; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> r; cin &gt;&gt; r;</span><br><span class="line">    <span class="built_in">addEdge</span>(<span class="number">0</span>, i, r, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">addEdge</span>(i+N, <span class="number">2</span>*N+<span class="number">1</span>, r, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  cin &gt;&gt; p &gt;&gt; m &gt;&gt; f &gt;&gt; n &gt;&gt; s;</span><br><span class="line">  <span class="comment">// begin point: i</span></span><br><span class="line">  <span class="comment">// ending point: i+N</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=N; ++i) &#123;</span><br><span class="line">    <span class="built_in">addEdge</span>(<span class="number">0</span>, i+N, inf, p);</span><br><span class="line">    <span class="keyword">if</span> (i&lt;N) <span class="built_in">addEdge</span>(i, i+<span class="number">1</span>, inf, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (i+m&lt;=N) <span class="built_in">addEdge</span>(i, i+N+m, inf, f);</span><br><span class="line">    <span class="keyword">if</span> (i+n&lt;=N) <span class="built_in">addEdge</span>(i, i+N+n, inf, s);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">spfa</span>()) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=<span class="number">2</span>*N+<span class="number">1</span>; ++i) vis[i] = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">0</span>, inf);</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; cost &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4011">P4011 孤岛营救问题</a></li>
</ul>
<p>这道题为什么要网络流啊。</p>
<p>难道不是直接暴力 BFS 寻找路径吗？</p>
<p>直接状压一下钥匙，然后每一次到达门就看有没有钥匙就可以了。</p>
<p>nt 的地方：<code>x(x), y(y)</code> 写成了 <code>x(x), y(x)</code> … …</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">11</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dy[] = &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, p, k, s, door[N][N][N][N];</span><br><span class="line"><span class="keyword">int</span> cnt[N][N], key[N][N][N];</span><br><span class="line"><span class="keyword">bool</span> vis[N][N][<span class="number">1</span>&lt;&lt;N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">spread</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> x, y, Key, cost;</span><br><span class="line">  <span class="built_in">spread</span>(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> Key, <span class="keyword">int</span> cost):</span><br><span class="line">    <span class="built_in">x</span>(x), <span class="built_in">y</span>(y), <span class="built_in">Key</span>(Key), <span class="built_in">cost</span>(cost) &#123;&#125;</span><br><span class="line">  <span class="built_in">spread</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">keyset</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> S = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=cnt[x][y]; ++i)</span><br><span class="line">    S |= (<span class="number">1</span>&lt;&lt;(key[x][y][i]<span class="number">-1</span>));</span><br><span class="line">  <span class="keyword">return</span> S;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> k, <span class="keyword">int</span> st)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x&lt;<span class="number">1</span> || x&gt;n) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (y&lt;<span class="number">1</span> || y&gt;m) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (k&lt;<span class="number">0</span> || (k &amp;&amp; !(st&amp;(<span class="number">1</span>&lt;&lt;(k<span class="number">-1</span>))))) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x = <span class="number">1</span>, y = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> S = <span class="built_in">keyset</span>(x, y);</span><br><span class="line">  queue &lt;spread&gt; que; que.<span class="built_in">push</span>(<span class="built_in">spread</span>(x, y, S, <span class="number">0</span>));</span><br><span class="line">  vis[x][y][S] = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    spread cur = que.<span class="built_in">front</span>(); que.<span class="built_in">pop</span>();</span><br><span class="line">    x = cur.x, y = cur.y, S = cur.Key;</span><br><span class="line">    <span class="keyword">if</span> (x==n &amp;&amp; y==m) <span class="keyword">return</span> cur.cost;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; ++i) &#123;</span><br><span class="line">      <span class="keyword">int</span> tox = x + dx[i], toy = y + dy[i];</span><br><span class="line">      <span class="keyword">int</span> Door = door[x][y][tox][toy];</span><br><span class="line">      <span class="keyword">if</span> (!<span class="built_in">check</span>(tox, toy, Door, S)) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">int</span> to = S|<span class="built_in">keyset</span>(tox, toy);</span><br><span class="line">      <span class="keyword">if</span> (vis[tox][toy][to]) <span class="keyword">continue</span>;</span><br><span class="line">      vis[tox][toy][to] = <span class="literal">true</span>;</span><br><span class="line">      que.<span class="built_in">push</span>(<span class="built_in">spread</span>(tox, toy, to, cur.cost+<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m &gt;&gt; p &gt;&gt; k;</span><br><span class="line">  <span class="keyword">while</span> (k--) &#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, X, Y, G;</span><br><span class="line">    cin &gt;&gt; x &gt;&gt; y &gt;&gt; X &gt;&gt; Y &gt;&gt; G;</span><br><span class="line">    <span class="keyword">if</span> (G) door[x][y][X][Y] = door[X][Y][x][y] = G;</span><br><span class="line">    <span class="keyword">else</span> door[x][y][X][Y] = door[X][Y][x][y] = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  cin &gt;&gt; s;</span><br><span class="line">  <span class="keyword">while</span> (s--) &#123;</span><br><span class="line">    <span class="keyword">int</span> x, y, Q; cin &gt;&gt; x &gt;&gt; y &gt;&gt; Q;</span><br><span class="line">    key[x][y][++cnt[x][y]] = Q;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; <span class="built_in">bfs</span>() &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2764">P2764 最小路径覆盖问题</a></li>
</ul>
<p>众所周知最小路径覆盖 $=$ 顶点数 $-$ 最大匹配数，这个是很显然的。</p>
<p>Proof：因为对于每一个点一开始都可以作为一条路径，所以一开始就有 $n$ 条路径。因为每一次匹配相当于把两个点合并，所以路径条数相当于减掉了 $1$，所以最大匹配数就是合并的个数，所以最后就是 $n-$最大匹配数。<br>又因为二分图可以网络流乱搞，所以路径覆盖也可以网络流乱搞。</p>
<p>所以正常的 trick，拆点跑最大流。<br>路径输出比较正常，直接在 DFS 的时候找到起始点然后记录路径即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, s, t, cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> dep[N], head[N]; <span class="keyword">bool</span> inq[N];</span><br><span class="line"><span class="keyword">int</span> cost, path[N]; <span class="keyword">bool</span> vis[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to, nxt, flow;</span><br><span class="line">&#125; e[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  e[cnt].flow = f; head[u] = cnt;</span><br><span class="line"></span><br><span class="line">  e[++cnt].to = u;</span><br><span class="line">  e[cnt].nxt = head[v];</span><br><span class="line">  e[cnt].flow = <span class="number">0</span>; head[v] = cnt;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=t; ++i)</span><br><span class="line">    dep[i] = inf, inq[i] = <span class="literal">false</span>;</span><br><span class="line">  dep[s] = <span class="number">0</span>; queue &lt;<span class="keyword">int</span>&gt; sp;</span><br><span class="line">  sp.<span class="built_in">push</span>(s); inq[s] = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">while</span> (!sp.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = sp.<span class="built_in">front</span>(); sp.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">      <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">      <span class="keyword">if</span> (e[i].flow &amp;&amp; dep[to]==inf) &#123;</span><br><span class="line">        dep[to] = dep[cur] + <span class="number">1</span>, sp.<span class="built_in">push</span>(to);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dep[t] ^ inf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Max)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (cur==t) <span class="keyword">return</span> Max;</span><br><span class="line">  <span class="keyword">int</span> increase = Max;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i &amp;&amp; increase; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (e[i].flow &amp;&amp; dep[to]==dep[cur]+<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> res = <span class="built_in">dfs</span>(to, <span class="built_in">min</span>(increase, e[i].flow));</span><br><span class="line">      <span class="keyword">if</span> (!res) &#123; dep[to] = <span class="number">-1</span>; <span class="keyword">continue</span>; &#125;</span><br><span class="line">      e[i].flow -=  res, e[i^<span class="number">1</span>].flow += res;</span><br><span class="line">      path[cur] = to; <span class="keyword">if</span> (cur) vis[to-n] = <span class="literal">true</span>;</span><br><span class="line">      increase -= res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Max-increase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m; t = <span class="number">2</span>*n+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> u, v; cin &gt;&gt; u &gt;&gt; v;</span><br><span class="line">    <span class="built_in">addEdge</span>(u, n+v, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">addEdge</span>(s, i, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">addEdge</span>(i+n, t, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>; <span class="keyword">while</span> (<span class="built_in">check</span>()) ans += <span class="built_in">dfs</span>(s, inf);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (vis[i]) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">int</span> cur = i; cout &lt;&lt; i;</span><br><span class="line">    <span class="keyword">while</span>(path[cur] &amp;&amp; path[cur]^t)</span><br><span class="line">      cout &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; path[cur]-n, cur = path[cur]-n;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; n-ans &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4016">P4016 负载平衡问题</a></li>
</ul>
<p>听名字还挺高大上的。</p>
<p>其实就是个卡牌游戏啊，只不过每一次只可以交换环上相邻两个。<br>那么直接断环成链，拿原数减掉最后的固定答案然后前缀和加到 <code>ans</code>。</p>
<p>顺带卡了下常，12ms 最优解 Rank1。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> n, sum, ans, a[<span class="number">110</span>], Sum[<span class="number">110</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">abs</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x&gt;<span class="number">0</span>? x:-x; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">qsort</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> mid = Sum[(l+r)&gt;&gt;<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">int</span> i=l, j=r;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (Sum[i]&lt;mid) ++i;</span><br><span class="line">    <span class="keyword">while</span> (Sum[j]&gt;mid) --j;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;=j) &#123;</span><br><span class="line">      <span class="keyword">int</span> u=Sum[i]; Sum[i]=Sum[j]; Sum[j]=u;</span><br><span class="line">      i++, j--;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (i&lt;=j);</span><br><span class="line">  <span class="keyword">if</span> (l&lt;j) <span class="built_in">qsort</span>(l, j);</span><br><span class="line">  <span class="keyword">if</span> (i&lt;r) <span class="built_in">qsort</span>(i, r);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]), sum += a[i];</span><br><span class="line">  sum /= n;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    Sum[i] = Sum[i<span class="number">-1</span>]+a[i]-sum, a[i] = Sum[i];</span><br><span class="line">  <span class="built_in">qsort</span>(<span class="number">1</span>, n); <span class="keyword">int</span> mid = n/<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    ans += <span class="built_in">abs</span>(Sum[mid]-Sum[i]);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/UVA11380">UVA11380 Down Went The Titanic</a></li>
</ul>
<p>简单题。</p>
<p>首先看到点有限制，直接拆点。</p>
<p>那么因为没有给出单源点和汇点，分别建一个。</p>
<p>接着可以将 <code>*</code> 视为连向源点，所以边权为 $1$。<br>同理 <code>#</code> 视为连向汇点，边权为限制 $p$。</p>
<p>然后因为 <code>.</code> 只能踩一次，所以拆成两个点，两个点之间的限制为 $1$。<br><code>@</code> 可以踩无数次，所以连 INF。</p>
<p>接着因为周边四个点都可以扩展到（除起始点和水显然不可以扩展）。<br>所以连容量为 INF 的边。</p>
<p>然后跑一遍最大流。</p>
<p>记得多测 <code>cnt</code> 要赋成 $1$ 而不是 $0$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[<span class="number">4</span>] = &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dy[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, p, s, t, cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> dep[N], head[N]; <span class="keyword">char</span> ch[<span class="number">40</span>][<span class="number">40</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to, nxt, flow;</span><br><span class="line">&#125; e[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v, e[cnt].nxt = head[u];</span><br><span class="line">  e[cnt].flow = f, head[u] = cnt;</span><br><span class="line">  e[++cnt].to = u, e[cnt].nxt = head[v];</span><br><span class="line">  e[cnt].flow = <span class="number">0</span>, head[v] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x&lt;<span class="number">1</span> || x&gt;n || y&lt;<span class="number">1</span> || y&gt;m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  cnt = <span class="number">1</span>; t = <span class="number">2</span>*n*m + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=m; ++j) cin &gt;&gt; ch[i][j];</span><br><span class="line">  <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> (x<span class="number">-1</span>)*m+y; &#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=s; i&lt;=t; ++i) dep[i] = inf;</span><br><span class="line">  dep[s] = <span class="number">0</span>; queue &lt;<span class="keyword">int</span>&gt; sp; sp.<span class="built_in">push</span>(s);</span><br><span class="line">  <span class="keyword">while</span> (!sp.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = sp.<span class="built_in">front</span>(); sp.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; ~i; i=e[i].nxt) &#123;</span><br><span class="line">      <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">      <span class="keyword">if</span> (e[i].flow &amp;&amp; dep[to]==inf) &#123;</span><br><span class="line">        dep[to] = dep[cur] + <span class="number">1</span>, sp.<span class="built_in">push</span>(to);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dep[t]^inf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Max)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (cur==t) <span class="keyword">return</span> Max;</span><br><span class="line">  <span class="keyword">int</span> increase = Max;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; ~i &amp;&amp; increase; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (e[i].flow &amp;&amp; dep[to]==dep[cur]+<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">int</span> res = <span class="built_in">dfs</span>(to, <span class="built_in">min</span>(increase, e[i].flow));</span><br><span class="line">      <span class="keyword">if</span> (!res) <span class="keyword">continue</span>;</span><br><span class="line">      e[i].flow -= res, e[i^<span class="number">1</span>].flow += res;</span><br><span class="line">      increase -= res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Max-increase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;p) != EOF) &#123;</span><br><span class="line">    <span class="built_in">init</span>(); <span class="keyword">int</span> siz = n*m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=m; ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[i][j] == <span class="string">&#x27;~&#x27;</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (ch[i][j] == <span class="string">&#x27;*&#x27;</span>) <span class="built_in">addEdge</span>(s, <span class="built_in">id</span>(i,j), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (ch[i][j] == <span class="string">&#x27;.&#x27;</span>) <span class="built_in">addEdge</span>(<span class="built_in">id</span>(i,j), <span class="built_in">id</span>(i,j)+siz, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (ch[i][j] == <span class="string">&#x27;#&#x27;</span>) <span class="built_in">addEdge</span>(<span class="built_in">id</span>(i,j), t, p);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">4</span>; ++k) &#123;</span><br><span class="line">          <span class="keyword">int</span> tox = i+dx[k], toy = j+dy[k];</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">check</span>(tox, toy)) <span class="keyword">continue</span>;</span><br><span class="line">          <span class="keyword">if</span> (ch[tox][toy] == <span class="string">&#x27;*&#x27;</span> || ch[tox][toy] == <span class="string">&#x27;~&#x27;</span>) <span class="keyword">continue</span>;</span><br><span class="line">          <span class="keyword">if</span> (ch[i][j] == <span class="string">&#x27;.&#x27;</span>) <span class="built_in">addEdge</span>(<span class="built_in">id</span>(i,j)+siz, <span class="built_in">id</span>(tox, toy), inf);</span><br><span class="line">          <span class="keyword">else</span> <span class="built_in">addEdge</span>(<span class="built_in">id</span>(i,j), <span class="built_in">id</span>(tox, toy), inf);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">spfa</span>()) ans += <span class="built_in">dfs</span>(s, inf);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3965">P3965 循环格</a></li>
</ul>
<p>这题也是个拆点模板。<br>首先 S 连向出点，T 连向入点，默认已经拆完点。<br>所以因为要使得成为循环格，所以要进行两两之间点的匹配。<br>即入度、出度均为 $1$。</p>
<p>所以跑二分图匹配最小费用即可。<br>建边的 value 只需要看当前点实际指的方向是否是枚举的方向。<br>如果是费用为 $0$，否则为 $1$。</p>
<p>最后要注意：<code>cnt</code> 要赋成 $1$！！11</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">114514</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, s, t, cnt = <span class="number">1</span>, cost;</span><br><span class="line"><span class="keyword">int</span> dist[N], head[N];</span><br><span class="line"><span class="keyword">bool</span> vis[N], inq[N];</span><br><span class="line"><span class="keyword">char</span> Map[<span class="number">20</span>][<span class="number">20</span>]; <span class="keyword">int</span> To[<span class="number">20</span>][<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dy[] = &#123;<span class="number">-1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to, nxt, flow, val;</span><br><span class="line">&#125; e[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> f, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v, e[cnt].nxt = head[u];</span><br><span class="line">  e[cnt].flow = f, e[cnt].val = w, head[u] = cnt;</span><br><span class="line">  e[++cnt].to = u, e[cnt].nxt = head[v];</span><br><span class="line">  e[cnt].flow = <span class="number">0</span>, e[cnt].val = -w, head[v] = cnt;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=s; i&lt;=t; ++i)</span><br><span class="line">    inq[i] = <span class="literal">false</span>, dist[i] = inf;</span><br><span class="line">  dist[s] = <span class="number">0</span>, inq[s] = <span class="literal">true</span>;</span><br><span class="line">  queue &lt;<span class="keyword">int</span>&gt; sp; sp.<span class="built_in">push</span>(s);</span><br><span class="line">  <span class="keyword">while</span> (!sp.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = sp.<span class="built_in">front</span>(); sp.<span class="built_in">pop</span>();</span><br><span class="line">    inq[cur] = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; ~i; i=e[i].nxt) &#123;</span><br><span class="line">      <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">      <span class="keyword">if</span> (e[i].flow &amp;&amp; dist[to]&gt;dist[cur]+e[i].val) &#123;</span><br><span class="line">        dist[to] = dist[cur] + e[i].val;</span><br><span class="line">        <span class="keyword">if</span> (!inq[to]) &#123; inq[to] = <span class="literal">true</span>; sp.<span class="built_in">push</span>(to); &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dist[t]^inf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Max)</span> </span>&#123;</span><br><span class="line">  vis[cur] = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (cur==t) <span class="keyword">return</span> Max;</span><br><span class="line">  <span class="keyword">int</span> increase = Max;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; ~i &amp;&amp; increase; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> ((!vis[to]||to==t) &amp;&amp; e[i].flow &amp;&amp; dist[to]==dist[cur]+e[i].val) &#123;</span><br><span class="line">      <span class="keyword">int</span> res = <span class="built_in">dfs</span>(to, <span class="built_in">min</span>(increase, e[i].flow));</span><br><span class="line">      <span class="keyword">if</span> (!res) <span class="keyword">continue</span>;</span><br><span class="line">      e[i].flow -= res, e[i^<span class="number">1</span>].flow += res;</span><br><span class="line">      increase -= res, cost += res * e[i].val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Max-increase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123; <span class="keyword">return</span> (x<span class="number">-1</span>)*m+y; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head);</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m; t = <span class="number">2</span>*n*m + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=m; ++j) &#123;</span><br><span class="line">      cin &gt;&gt; Map[i][j];</span><br><span class="line">      <span class="keyword">if</span> (Map[i][j]==<span class="string">&#x27;L&#x27;</span>) To[i][j] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (Map[i][j]==<span class="string">&#x27;R&#x27;</span>) To[i][j] = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (Map[i][j]==<span class="string">&#x27;U&#x27;</span>) To[i][j] = <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">if</span> (Map[i][j]==<span class="string">&#x27;D&#x27;</span>) To[i][j] = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=m; ++j) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;<span class="number">4</span>; ++k) &#123;</span><br><span class="line">        <span class="keyword">int</span> tox = i+dx[k], toy = j+dy[k];</span><br><span class="line">        <span class="keyword">if</span> (tox&lt;<span class="number">1</span>) tox = n; <span class="keyword">if</span> (tox&gt;n) tox = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (toy&lt;<span class="number">1</span>) toy = m; <span class="keyword">if</span> (toy&gt;m) toy = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">addEdge</span>(<span class="built_in">id</span>(i,j)+n*m, <span class="built_in">id</span>(tox, toy), <span class="number">1</span>, k!=To[i][j]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=m; ++j) &#123;</span><br><span class="line">      <span class="built_in">addEdge</span>(s, <span class="built_in">id</span>(i,j)+n*m, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="built_in">addEdge</span>(<span class="built_in">id</span>(i,j), t, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">spfa</span>()) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=s; i&lt;=t; ++i) vis[i] = <span class="literal">false</span>;</span><br><span class="line">    ans += <span class="built_in">dfs</span>(s, inf);</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; cost &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/02/Introduction/"><img class="fill" src="https://z3.ax1x.com/2021/08/02/fCS6i9.png" alt="Introduction"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-02T11:29:34.000Z" title="2021/8/2 下午7:29:34">2021-08-02</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-03T12:02:49.582Z" title="2021/8/3 下午8:02:49">2021-08-03</time></span><span class="level-item"><a class="link-muted" href="/categories/Daily/">Daily</a></span><span class="level-item">a few seconds read (About 44 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/02/Introduction/">Introduction</a></h1><div class="content"><p>First of all, this is my first successful hexo Blog!<br>I may be a pigeon in the future …</p>
<p>u1s1 hexo is better than Gridea …<br>And maybe I will put my Luogu Blog away qaq</p>
<h2 id="Test-for-Markdown-amp-LaTeX"><a href="#Test-for-Markdown-amp-LaTeX" class="headerlink" title="Test for Markdown &amp; LaTeX"></a>Test for Markdown &amp; LaTeX</h2><p>$$\sum\limits_{i=1}^na_i$$</p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://z3.ax1x.com/2021/08/02/f9l1RP.jpg" alt="Xcel"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Xcel</p><p class="is-size-6 is-block">A Lovely OIer!</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Changsha, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">6</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/lbn233" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/lbn233"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com/MizuQ"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/C5H8N4O12"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.luogu.com.cn/user/487752" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">My Luogu</span></span><span class="level-right"><span class="level-item tag">www.luogu.com.cn</span></span></a></li><li><a class="level is-mobile" href="https://blog.calvincheng1231.org.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Calvin&#039;s Blog</span></span><span class="level-right"><span class="level-item tag">blog.calvincheng1231.org.cn</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Daily/"><span class="level-start"><span class="level-item">Daily</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Notes/"><span class="level-start"><span class="level-item">Notes</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Sol/"><span class="level-start"><span class="level-item">Sol</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-04T14:40:09.000Z">2021-08-04</time></p><p class="title"><a href="/2021/08/04/About-Dynamic-Point-Segment-Tree/">About Dynamic-Point Segment Tree</a></p><p class="categories"><a href="/categories/Notes/">Notes</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-04T04:35:39.000Z">2021-08-04</time></p><p class="title"><a href="/2021/08/04/CF961G-Solution/">CF961G Solution</a></p><p class="categories"><a href="/categories/Sol/">Sol</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-04T01:13:40.000Z">2021-08-04</time></p><p class="title"><a href="/2021/08/04/P2150-Solution/">P2150 Solution</a></p><p class="categories"><a href="/categories/Sol/">Sol</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T14:34:50.000Z">2021-08-03</time></p><p class="title"><a href="/2021/08/03/System-of-Difference-Constraints/">差分约束重提</a></p><p class="categories"><a href="/categories/Notes/">Notes</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-03T08:56:16.000Z">2021-08-03</time></p><p class="title"><a href="/2021/08/03/DS-On-Tree/">DS On Tree</a></p><p class="categories"><a href="/categories/Notes/">Notes</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/DS/"><span class="tag">DS</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Graph/"><span class="tag">Graph</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Network-Flows/"><span class="tag">Network Flows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Number-Theory/"><span class="tag">Number Theory</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Others/"><span class="tag">Others</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/State-Compression/"><span class="tag">State Compression</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Xcel&#039;s Little House</a><p class="is-size-7"><span>&copy; 2021 Xcel</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'folded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>