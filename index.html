<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Xcel&#039;s Little House</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Xcel&#039;s Little House"><meta name="msapplication-TileImage" content="https://z3.ax1x.com/2021/08/12/fwFGE6.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Xcel&#039;s Little House"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Everything to Discover!"><meta property="og:type" content="blog"><meta property="og:title" content="Xcel&#039;s Little House"><meta property="og:url" content="https://lbn233.github.io/"><meta property="og:site_name" content="Xcel&#039;s Little House"><meta property="og:description" content="Everything to Discover!"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://z3.ax1x.com/2021/08/12/fdWHyt.jpg"><meta property="article:author" content="Xcel"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://z3.ax1x.com/2021/08/12/fdWHyt.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://lbn233.github.io"},"headline":"Xcel's Little House","image":["https://lbn233.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Xcel"},"publisher":{"@type":"Organization","name":"Xcel's Little House","logo":{"@type":"ImageObject","url":{"text":"Xcel's Little House"}}},"description":"Everything to Discover!"}</script><link rel="icon" href="https://z3.ax1x.com/2021/08/12/fwFGE6.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Xcel&#039;s Little House</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/09/04/Persistence-Data-Structure/"><img class="fill" src="https://tva1.sinaimg.cn/large/87c01ec7gy1fsnqqkin2oj21kw0w0gzz.jpg" alt="可持久化数据结构"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-09-04T14:30:18.000Z" title="2021/9/4 下午10:30:18">2021-09-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-09-04T15:07:13.312Z" title="2021/9/4 下午11:07:13">2021-09-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">7 minutes read (About 980 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/04/Persistence-Data-Structure/">可持久化数据结构</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3919">可持久化线段树 1</a></li>
</ul>
<p>历史版本修改和查询，每一次操作生成一个历史版本。</p>
<p>知道可持久化思想就不难了。<br>大概就是对于每一个点可以丢到线段树上的叶子节点。<br>然后对于每一个历史版本，确定了根和每一个节点的左右节点那就知道了整棵树。<br>所以可以直接拿一个 <code>root</code> 数组来作为历史版本的信息存储。<br>然后显而易见地，发现对于每一个修改操作都会修改不超过 $\log n$ 个点。<br>形式化地，就是修改了当前节点到根节点路径上的所有节点。<br>所有信息都可以合并一下，然后更新 <code>root</code> 节点。</p>
<p>大概就没了，时间复杂度和空间复杂度均为 $N \log N$（猜的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">2e7</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span> &#123;</span> <span class="keyword">int</span> l, r, val; &#125; t[MAXN];</span><br><span class="line"><span class="keyword">int</span> n, Q, tot, a[N], rt[N];</span><br><span class="line"><span class="keyword">int</span> basic, opt, pos, val;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">New</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; t[++tot] = t[x]; <span class="keyword">return</span> tot; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  x = ++tot;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; t[x].val = a[l]; <span class="keyword">return</span> tot; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  t[x].l = <span class="built_in">build</span>(t[x].l, l, mid);</span><br><span class="line">  t[x].r = <span class="built_in">build</span>(t[x].r, mid+<span class="number">1</span>, r);</span><br><span class="line">  <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">  x = <span class="built_in">New</span>(x);</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; t[x].val = v; <span class="keyword">return</span> x; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (pos&lt;=mid) t[x].l = <span class="built_in">upd</span>(t[x].l, l, mid, pos, v);</span><br><span class="line">  <span class="keyword">else</span> t[x].r = <span class="built_in">upd</span>(t[x].r, mid+<span class="number">1</span>, r, pos, v);</span><br><span class="line">  <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l==r) <span class="keyword">return</span> t[x].val;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (pos&lt;=mid) <span class="keyword">return</span> <span class="built_in">query</span>(t[x].l, l, mid, pos);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">query</span>(t[x].r, mid+<span class="number">1</span>, r, pos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x&lt;<span class="number">0</span>) &#123; <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>); x = -x; &#125;</span><br><span class="line">  <span class="keyword">if</span> (x&gt;<span class="number">9</span>) <span class="built_in">print</span>(x/<span class="number">10</span>);</span><br><span class="line">  <span class="built_in">putchar</span>(x%<span class="number">10</span>^<span class="number">48</span>); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(Q);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(a[i]);</span><br><span class="line">  rt[<span class="number">0</span>] = <span class="built_in">build</span>(<span class="number">0</span>, <span class="number">1</span>, n);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Q; ++i) &#123;</span><br><span class="line">    <span class="built_in">read</span>(basic), <span class="built_in">read</span>(opt), <span class="built_in">read</span>(pos);</span><br><span class="line">    <span class="keyword">if</span> (opt==<span class="number">1</span>) <span class="built_in">read</span>(val), rt[i] = <span class="built_in">upd</span>(rt[basic], <span class="number">1</span>, n, pos, val);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">print</span>(<span class="built_in">query</span>(rt[basic], <span class="number">1</span>, n, pos)), <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>), rt[i] = rt[basic];</span><br><span class="line">  &#125; <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3834">可持久化线段树 2</a></li>
</ul>
<p>主席树入门题（？<br>这主席树还是静态的，那么我们可以乱搞了。<br>首先分块老哥靠边（</p>
<p>如果我们要找到区间第 $k$ 小那么是不是可以直接维护区间内某些值的个数<br>如果一段前缀某些数的个数和 $&lt;k$ 那么可以直接遍历另外一半<br>所以直接想到了线段树的左儿子和右儿子 然后直接遍历搞</p>
<p>因为你这样显然是要建一个值域的是吧<br>然后因为值域你开不下啊，所以离散化一样，不改变相对关系<br>最后在询问值得时候代回去就可以了</p>
<p>重点是我们怎么维护前缀某些数个数和<br>你现在有一堆结构体 <code>tree[N]</code><br>然后 $\forall \space 1 \le i \le n$，<code>tree[i]</code> 代表了一段前缀的信息</p>
<p>信息的具体处理方式可以参考这样：<code>3 3 4 6 9 1 1 4 1</code></p>
<p>然后你离散化每一个位置维护的值就应该是其出现的次数<br>那么就变成这样了 <code>3[1] 2[3] 2[4] 1[6] 1[9]</code><br>但是你每个前缀都建一颗线段树，时间复杂度抛开不说，你空间跑不了啊<br>然后发现每一个前缀都和前面处理的信息有极大的重复<br>所以参考上面的方法 直接共用一大堆节点，新建相当于 $\log N$ 了。</p>
<p>所以时间复杂度和空间复杂度都是 $N \log N$ 了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, Q, tot, a[N], b[N], tmp[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span> &#123;</span> <span class="keyword">int</span> l, r, val; &#125; t[N*<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> rt = ++tot; t[rt].val = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (l&lt;r) &#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    t[rt].l = <span class="built_in">build</span>(l, mid);</span><br><span class="line">    t[rt].r = <span class="built_in">build</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">  &#125; <span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> pre, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> rt = ++tot;</span><br><span class="line">  t[rt].l = t[pre].l, t[rt].r = t[pre].r;</span><br><span class="line">  t[rt].val = t[pre].val + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (l&lt;r) &#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (pos&lt;=mid) t[rt].l = <span class="built_in">upd</span>(t[pre].l, l, mid, pos);</span><br><span class="line">    <span class="keyword">else</span> t[rt].r = <span class="built_in">upd</span>(t[pre].r, mid+<span class="number">1</span>, r, pos);</span><br><span class="line">  &#125; <span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> rk)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l&gt;=r) <span class="keyword">return</span> l;</span><br><span class="line">  <span class="keyword">int</span> val = t[t[y].l].val - t[t[x].l].val;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (val&gt;=rk) <span class="keyword">return</span> <span class="built_in">query</span>(t[x].l, t[y].l, l, mid, rk);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(t[x].r, t[y].r, mid+<span class="number">1</span>, r, rk-val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(Q);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="built_in">read</span>(a[i]), b[i] = a[i];</span><br><span class="line">  <span class="built_in">sort</span>(b+<span class="number">1</span>, b+<span class="number">1</span>+n);</span><br><span class="line">  <span class="keyword">int</span> Len = <span class="built_in">unique</span>(b+<span class="number">1</span>, b+<span class="number">1</span>+n)-b<span class="number">-1</span>;</span><br><span class="line">  tmp[<span class="number">0</span>] = <span class="built_in">build</span>(<span class="number">1</span>, Len);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = <span class="built_in">lower_bound</span>(b+<span class="number">1</span>, b+<span class="number">1</span>+Len, a[i])-b;</span><br><span class="line">    tmp[i] = <span class="built_in">upd</span>(tmp[i<span class="number">-1</span>], <span class="number">1</span>, Len, cur);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (Q--) &#123;</span><br><span class="line">    <span class="keyword">int</span> l, r, k; <span class="built_in">read</span>(l), <span class="built_in">read</span>(r), <span class="built_in">read</span>(k);</span><br><span class="line">    <span class="keyword">int</span> id = <span class="built_in">query</span>(tmp[l<span class="number">-1</span>], tmp[r], <span class="number">1</span>, Len, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, b[id]);</span><br><span class="line">  &#125; <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>tmp</code> 维护的就是上述的根，然后常规处理。</p>
<hr>
<p>好的，这些就是暂时的可持久化博客了。<br>Flag：树套树，懒标记专题，线性基，如果咕了 QQ 催我。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/31/FFT-and-NTT/"><img class="fill" src="https://tva4.sinaimg.cn/large/87c01ec7gy1fsnqqs9h01j21kw0w04ek.jpg" alt="关于 FFT 和 NTT 等多项式科技的学习"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-31T07:47:49.000Z" title="2021/8/31 下午3:47:49">2021-08-31</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-09-04T15:05:06.018Z" title="2021/9/4 下午11:05:06">2021-09-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">15 minutes read (About 2310 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/31/FFT-and-NTT/">关于 FFT 和 NTT 等多项式科技的学习</a></h1><div class="content"><p>给大家整个活。</p>
<p>最基础的狒狒贴可以 $O(N \log N)$ 解决多项式乘法。<br>朴素的就是 $O(N^2)$ 比较低端。</p>
<p>狒狒贴先是把一个用系数表示的多项式转化为点值表示。<br>然后通过这样的转换搞科技。</p>
<p>首先一个 $n-1$ 次 $n$ 项多项式 $\rightarrow f(x)=\sum\limits_{i=0}^{n-1}a_{i}x^i$， 默认 $a_{0,…,n-1}$。<br>或者可以表示为 $f(x)={a_0,a_1,…,a_{ n-1}}$。</p>
<p>然后引入一种高级的东西 - 点值表示法。<br>把一个多项式丢到平面直角坐标系里面，看成一个函数。<br>然后不同的 $x$ 代进去 $f(x)$ 都会得到不同的 $(x,f(x))$。</p>
<p>然后规定一下 $f(x)$ 用 ${(x_0,f(x_0)),…,(x_{n-1},f(x_{n-1}))}$ 表示，就是点值表示法。</p>
<p>然后如果你要暴力搞的话肯定系数转点值和点值转系数都 $O(N^2)$。<br>两种朴素算法分别叫做 DFT 和 IDFT，离散傅里叶变换和离散傅里叶逆变换。</p>
<p>首先可以直接将任何一个复数表示到复平面直角坐标系上面变成一个点。<br>横坐标是实部，单位为 $1$；纵坐标为虚部，单位为 $i=\sqrt{-1}$。<br>复数运算不多赘述了。</p>
<hr>
<p>多项式转点值可以找到一个地方突破，就是代入一组特殊的 $x$ 使次方运算减少。<br>那么就可以直接钦定一个复平面坐标系上以原点为圆心划一个半径为 $1$ 的圆。<br>例如 $(0,i) \rightarrow (1,0) \rightarrow (0,-i) \rightarrow (-1,0)$ 这样一个圆。<br>规定一下方便的叫法，这是个单位圆。<br>那么所有点经过若干次方都可以变成 $1$。</p>
<p>方便起见可以把它分成 $n$ 份代表 $n$ 项式。<br>从 $(1,0)$ 开始逆时针编号，其实随便怎么标都可以，你开心就好。<br>令 $\omega_{n}^1$ 代表 $n$ 次单位根。<br>然后设第 $i$ 个点的复数值为 $\omega_{n}^i$。  </p>
<p>然后丢个简单的公式，就是模长相乘，极角相加。<br>大概就是 $(a,\theta_{1})\times(b,\theta_2)=(ab,\theta_1+\theta_2)$，其中横坐标为实，纵坐标为虚。</p>
<p>这里就可以稍稍拓展一下知道 $\omega_n^{i+j}=\omega_n^i \times \omega_n^j$。<br>然后由定义显然有 $(\omega_{n}^i)^j=\omega_n^{ij}$。</p>
<p>所以由这个公式知道 $(\omega_{n}^1)^i=\omega_n^i$。<br>那么每一个 $\omega$ 就可以通过三角函数乘上占的比例求出来。</p>
<p>$$\omega_n^k=\cos\dfrac{k}{n}2\pi+i\sin\dfrac{k}{n}2\pi$$</p>
<p>（这里下标不用 $i$ 了是因为怕跟虚数单位 $i$ 混淆）</p>
<p>那么这一大堆 $\omega$ 就可以当 $x_{0…n-1}$。</p>
<p>推狒狒贴需要用到两个性质，就是可以拿来搞分治的两个性质。</p>
<p>就是 $\omega_n^k=\cos \dfrac{k}{n}2\pi+i\sin\dfrac{k}{n}2\pi=\cos \dfrac{2k}{2n}2\pi+i\sin\dfrac{2k}{2n}2\pi=\omega_{2n}^{2k}$。</p>
<p>以及 $\omega_n^i=-\omega_n^{i+\frac{n}{2}}$，就是类似一个多边形对角线的性质。</p>
<p>因为两个点关于原点对称所以有这个定理，很显然。</p>
<p>那么下面就是整活的推柿子了。</p>
<p>设 $f(n)=\sum\limits_{i=0}^{n-1}a_ix^i=a_0+a_1x+a_2x^2+…+a_{n-1}x^{n-1}$</p>
<p>默认 $n$ 为奇数，方便计算。</p>
<p>那么将 $f(n)$ 按照下标奇偶性分成两半</p>
<p>$=(a_0+a_2x^2+…+a_{n-2}x^{n-2})+(a_1x+a_3x^3+…+a_{n-1}x^{n-1})$<br>$=(a_0+a_2x^2+…+a_{n-2}x^{n-2})+x(a_1+a_3x^2+…+a_{n-1}x^{n-2})$</p>
<p>然后因为两边非常相似，所以设</p>
<p>$f_1(n)=a_0+a_2x+a_4x^2+…+a_{n-2}x^{\frac{n-2}{2}}$<br>$f_2(n)=a_1+a_3x+a_5x^2+…+a_{n-1}x^{\frac{n-2}{2}}$</p>
<p>很明显可以把 $f_1$ 和 $f_2$ 代进去。</p>
<p>原式 $=f_1(n^2)+n\times f_2(n^2)$</p>
<p>然后可以开始 DFS / 迭代这样子做，前半段设有 $i&lt;\dfrac{n}{2}$，那么把 $x=\omega_n^i$ 代入原式</p>
<p>$f(\omega_n^i)=f_1((\omega_n^i)^2)+\omega_n^i\times f_2((\omega_n^i)^2)$</p>
<p>然后因为是平方，所以 $2$  可以乘到上面去，所以有</p>
<p>原式 $=f_1(\omega_n^{2i})+\omega_n^i \times f_2(\omega_n^{2i})=f_1(\omega_{\frac{n}{2}}^i)+\omega_n^i \times f_2(\omega_{\frac{n}{2}}^i)$</p>
<p>后面那个成立是因为 $\omega_{n}^i=\omega_{2n}^{2i}$。</p>
<p>因为分治特别好玩，所以后面那段也要分治。</p>
<p>同理可以推推推，设 $t=\dfrac{n}{2}$（手敲累了）。</p>
<p>$f(\omega_n^{i+t})=f_1(\omega_n^{2i+n})+\omega_n^{i+t}\times f_2(\omega_n^{2i+n})$</p>
<p>因为显然有 $\omega_{n}^{2i+n}=\omega_n^n \times \omega_{n}^{2i}$<br>所以直接拆开，因为 $\omega_n^n=\omega_n^0=0$，跑路。</p>
<p>原式 $=f_1(\omega_n^{2i})+\omega_n^{i+t} \times f_2(\omega_n^{2i})$</p>
<p>做到这里发现推不动了，直到看到 $\omega_n^i=-\omega_n^{i+\frac{n}{2}}$ 这个玩意我们发现可以代进去。</p>
<p>原式 $=f_1(\omega_n^{2i})-\omega_n^i\times f_2(\omega_n^{2i})$。</p>
<p>然后因为 $\omega_{n}^i=\omega_{2n}^{2i}$ 有原式 $=f_1(\omega_{t}^i)-\omega_n^i \times f_2(\omega_{t}^i)$</p>
<p>最后发现后面那一项，两半分别为相反数。<br>所以我们知道 $f(\omega_n^i)$ 和 $f(\omega_n^{i+t})$ 只有后面那个地方不同。<br>换句话说知道了 $f(\omega_{n}^i)$ 就算出了 $f(\omega_n^{i+t})$。</p>
<p>那么就可以这样迭代下去求了。</p>
<p>时间复杂度 $O(\sum\limits_{i=0}^{\log_2N}2^i)=O(N \log N)$。</p>
<p>好耶，没有代码。</p>
<p>听说 DFS 版本的狒狒贴会 TLE。<br>到时候应该会贴一个迭代版本的狒狒贴上来。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rg register</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> MAX_LEN = <span class="number">5e7</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> bufin[MAX_LEN], *p1 = bufin;</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">define</span> gc() (*p1++)</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">define</span> isd(ch) (ch&gt;47&amp;&amp;ch&lt;58)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T &amp;ret)</span> </span>&#123;</span><br><span class="line">    ret = <span class="number">0</span>; rg T f = <span class="number">1</span>; <span class="keyword">char</span> ch = <span class="built_in">gc</span>();</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isd</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">gc</span>();</span><br><span class="line">    <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">gc</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isd</span>(ch)) ret = ret*<span class="number">10</span>+(ch^<span class="number">48</span>), ch = <span class="built_in">gc</span>();</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> cnt, tp;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">char</span> bf[<span class="number">20</span>], buf[MAX_LEN];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(T Num)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!Num) &#123; buf[cnt++] = <span class="string">&#x27;0&#x27;</span>, buf[cnt++] = <span class="string">&#x27; &#x27;</span>; <span class="keyword">return</span> ; &#125;</span><br><span class="line">    <span class="keyword">if</span> (Num&lt;<span class="number">0</span>) buf[cnt++] = <span class="string">&#x27;-&#x27;</span>, Num = -Num;</span><br><span class="line">    tp = <span class="number">0</span>; <span class="keyword">while</span> (Num)</span><br><span class="line">      bf[tp++] = Num%<span class="number">10</span>^<span class="number">48</span>, Num /= <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">while</span> (tp) buf[cnt++] = bf[--tp];</span><br><span class="line">    buf[cnt++] = <span class="string">&#x27; &#x27;</span>; <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Math &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">int</span> MAX_SIZE = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">int</span> Md, Range, fac[MAX_SIZE];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">static</span> T <span class="title">qpow</span><span class="params">(T bas, T pw)</span> </span>&#123;</span><br><span class="line">    T mult = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (pw) &#123;</span><br><span class="line">      <span class="keyword">if</span> (pw&amp;<span class="number">1</span>) mult = mult * bas % Md;</span><br><span class="line">      bas = bas * bas % Md, pw &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">return</span> mult;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">static</span> T <span class="title">inv</span><span class="params">(T x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">qpow</span>(x, Md<span class="number">-2</span>); &#125;</span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function"><span class="keyword">inline</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>] = fac[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (rg <span class="keyword">int</span> i=<span class="number">2</span>; i&lt;=Range; ++i)</span><br><span class="line">      fac[i] = <span class="number">1LL</span> * fac[i<span class="number">-1</span>] * i % Md;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> IO;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Math;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> pi = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">3e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cplx</span> &#123;</span></span><br><span class="line">  <span class="keyword">double</span> real, im;</span><br><span class="line">  <span class="built_in">cplx</span> (<span class="keyword">double</span> real, <span class="keyword">double</span> im):</span><br><span class="line">    <span class="built_in">real</span>(real), <span class="built_in">im</span>(im) &#123;&#125;</span><br><span class="line">  <span class="built_in">cplx</span>() &#123;&#125;</span><br><span class="line">&#125; x[N], y[N];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手写复数太丑了略过</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, Log, Lim = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> status[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">FFT</span><span class="params">(cplx *x, <span class="keyword">int</span> typ)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;Lim; ++i)</span><br><span class="line">    <span class="keyword">if</span> (i&lt;status[i]) <span class="built_in">Swap</span>(x[i], x[status[i]]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> mid=<span class="number">1</span>; mid&lt;Lim; mid&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="function">cplx <span class="title">omega</span><span class="params">(cos(pi/mid), typ*sin(pi/mid))</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> rig=mid&lt;&lt;<span class="number">1</span>, pos=<span class="number">0</span>; pos&lt;Lim; pos+=rig) &#123;</span><br><span class="line">      <span class="function">cplx <span class="title">pw</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;mid; ++k, pw=pw*omega) &#123;</span><br><span class="line">        cplx buf1 = x[pos+k], buf2 = pw * x[pos+k+mid];</span><br><span class="line">        x[pos+k] = buf1 + buf2, x[pos+k+mid] = buf1 - buf2;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">fread</span>(IO::bufin, <span class="number">1</span>, <span class="number">50000000</span>, stdin);</span><br><span class="line">  IO::<span class="built_in">read</span>(n), IO::<span class="built_in">read</span>(m);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=n; ++i) IO::<span class="built_in">read</span>(x[i].real);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=m; ++i) IO::<span class="built_in">read</span>(y[i].real);</span><br><span class="line">  <span class="keyword">while</span> (Lim&lt;=(n+m)) ++Log, Lim&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;Lim; ++i)</span><br><span class="line">    status[i] = (status[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>) | ((i&amp;<span class="number">1</span>)&lt;&lt;(Log<span class="number">-1</span>));</span><br><span class="line">  <span class="built_in">FFT</span>(x, <span class="number">1</span>), <span class="built_in">FFT</span>(y, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=Lim; ++i) x[i] = x[i] * y[i];</span><br><span class="line">  <span class="built_in">FFT</span>(x, <span class="number">-1</span>); <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=n+m; ++i)</span><br><span class="line">    IO::<span class="built_in">print</span>((<span class="keyword">int</span>)(x[i].real/Lim+<span class="number">.5</span>));</span><br><span class="line">  <span class="built_in">fwrite</span>(IO::buf, <span class="number">1</span>, IO::cnt, stdout); <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>闹太套主要思想就是把毒瘤的狒狒贴复数给换掉<br>换成一种可以代替复数的、并且能够解决精度问题的东西，原根。</p>
<p>介绍几个专有名词。</p>
<p><strong>阶</strong>：如果 $\gcd(a,p)=1$ 并且 $p&gt;1$，<br>那么对于 $n_{\min}$ 满足 $a^n \equiv 1 \space (\bmod \space p)$，我们称 $n$ 为 $a$ 模 $p$ 的阶，记作 $\delta_p(a)$。</p>
<p><strong>原根</strong>：设 $p \in N^*,\space a \in Z$（不会打 $\LaTeX$，轻喷）。<br>如果 $\delta_p(a)=\phi(p)$，则称 $a$ 为模 $p$ 的一个原根。</p>
<p>原根存在的充要条件是，原根 $d=2,4,x^y,2x^y$（其中 $x$ 为奇素数，$y \ge 1$）。<br>每一个正整数 $p$ 都有 $\phi(\phi(p))$ 个原根，素数也一样。</p>
<p>闹太套到这里基本上就出来了，也就是最重要的定理：</p>
<ul>
<li>若 $p$ 为素数且 $g$ 为 $p$ 的原根，那么 $g^i \bmod p$ 的结果两两不同。<br>其中$g \in (1,p), \space i \in (0,p)$</li>
</ul>
<p>这玩意儿可以代替原来的复数来进行狒狒贴，所以有了个新名字，闹太套。<br>狒狒贴里面不是用到了单位根的几条性质吗，恰好原根也满足这几个性质。<br>所以原根就可以拿来代替毒瘤的复数了。（</p>
<p><del>如果有证明欢迎私信，我会蒯走</del></p>
<p>那么我们直接将 $\omega_i$ 替换为 $g^{\frac{p-1}{i}} \bmod p$ 即可。<br>$p$ 的取值嘛，听大佬说 $p$ 取 $998244353$ 非常好，原根为 $3$。</p>
<p>关于求原根，这个鸽子咕了 … …<br>大概求解任意一个质数 $t$ 的原根，只需要把 $t-1$ 分解质因数<br>变成 $t=\prod\limits_{i=1}^np_i^{k_i}$ 这样的乘积形式<br>然后如果 $\forall 1 \le i \le n, \space g^{\frac{t-1}{p_i}} \not =1 \space (\bmod\space t)$，那么 $g$ 为 $p$ 原根。</p>
<p>人太懒了没有加 fread 和 fwrite，导致跑得比狒狒贴还慢。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">3e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, Lim = <span class="number">1</span>, Log, status[N];</span><br><span class="line"><span class="keyword">int</span> a[N], b[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> bas, <span class="keyword">int</span> pw)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> mul = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (pw) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pw&amp;<span class="number">1</span>) mul = mul * bas % Mod;</span><br><span class="line">    bas = bas * bas % Mod;</span><br><span class="line">    pw &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">return</span> mul;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span> *x, <span class="keyword">int</span> typ)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;Lim; ++i)</span><br><span class="line">    <span class="keyword">if</span> (i&lt;status[i]) <span class="built_in">swap</span>(x[i], x[status[i]]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> mid=<span class="number">1</span>; mid&lt;Lim; mid&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">int</span> omega = <span class="built_in">qpow</span>(typ==<span class="number">1</span>? <span class="number">3</span>:<span class="number">332748118</span>, (Mod<span class="number">-1</span>)/(mid&lt;&lt;<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> pos=<span class="number">0</span>; pos&lt;Lim; pos+=(mid&lt;&lt;<span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">int</span> pw = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;mid; ++k, pw = (pw*omega)%Mod) &#123;</span><br><span class="line">        <span class="keyword">int</span> buf1 = x[pos+k], buf2 = pw * x[pos+k+mid] % Mod;</span><br><span class="line">        x[pos+k] = (buf1 + buf2) % Mod;</span><br><span class="line">        x[pos+k+mid] = ((buf1 - buf2) % Mod + Mod) % Mod;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=n; ++i) <span class="built_in">read</span>(a[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=m; ++i) <span class="built_in">read</span>(b[i]);</span><br><span class="line">  <span class="keyword">while</span> (Lim&lt;=(n+m)) ++Log, Lim&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;Lim; ++i)</span><br><span class="line">    status[i] = (status[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>) | ((i&amp;<span class="number">1</span>)&lt;&lt;(Log<span class="number">-1</span>));</span><br><span class="line">  <span class="built_in">NTT</span>(a, <span class="number">1</span>), <span class="built_in">NTT</span>(b, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;Lim; ++i) a[i] = (a[i] * b[i]) % Mod;</span><br><span class="line">  <span class="built_in">NTT</span>(a, <span class="number">-1</span>); <span class="keyword">int</span> inv = <span class="built_in">qpow</span>(Lim, Mod<span class="number">-2</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=n+m; ++i)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld &quot;</span>, a[i] * inv % Mod);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/20/Kachang-Skills/"><img class="fill" src="https://tva4.sinaimg.cn/large/87c01ec7gy1fsnqr5v7x6j21kw0w04k3.jpg" alt="一些卡常的小技巧"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-20T14:01:21.000Z" title="2021/8/20 下午10:01:21">2021-08-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-09-04T15:06:23.513Z" title="2021/9/4 下午11:06:23">2021-09-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">a minute read (About 154 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/20/Kachang-Skills/">一些卡常的小技巧</a></h1><div class="content">Here's something encrypted, password is required to continue reading.</div><a class="article-more button is-small is-size-7" href="/2021/08/20/Kachang-Skills/#more">Read more</a></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/13/Dyncmic-Tree-Devide/"><img class="fill" src="https://tva2.sinaimg.cn/large/87c01ec7gy1fsnqqq9cu9j21kw0w018a.jpg" alt="咕咕咕的动态淀粉质"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-12T23:55:14.000Z" title="2021/8/13 上午7:55:14">2021-08-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-09-04T15:04:52.903Z" title="2021/9/4 下午11:04:52">2021-09-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">5 minutes read (About 775 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/13/Dyncmic-Tree-Devide/">咕咕咕的动态淀粉质</a></h1><div class="content"><p>膜拜动态淀粉质。</p>
<p>首先动态淀粉质主要处理的是树上路径问题的修改与查询。对于某一个点 $rt$ 来说，其子树中的简单路径可以分成两种情况。（无根树）</p>
<ul>
<li>经过 $rt$ 的，即可以理解为由 $rt$ 发散出去一条或两条路径。</li>
<li>不经过 $rt$，可以通过处理 $rt$ 的子树来进行处理。</li>
</ul>
<p>所以我们现在只需要考虑第一种情况。</p>
<p>所以我们可以寻找当前处理的树的分治中心 $x$。<br>对于每一个分治中心，我们都可以将其所有子树视为几个连通块，然后删掉当前的节点 $rt$，递归分别处理，这样递归，构成一棵点分树。</p>
<p>那么很显然点分树每一层代表的节点个数都是 $\Theta(N)$ 级别的。</p>
<p>然后最深的递归层数显然是这棵树的深度。<br>那么很显然对于无根树我们把其根赋值为重心即可。</p>
<p>假设最深深度为 $d$，那么点分树建出来时间复杂度为 $\Theta(Nd)$。<br>那么使得 $d$ 最小就应该将分治中心设为每一个树上连通块的重心。<br>此时时间复杂度理论上最小，为 $\Theta(N \log N)$ 级别。</p>
<p>然后就这样递归乱搞就可以了。</p>
<p>淀粉质 AC 代码。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1e7</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, cnt, rt, totsiz, tot, head[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> Maxi[N], siz[N], dist[N], Dis[N];</span><br><span class="line"><span class="keyword">bool</span> Exist[M], vis[N], hasret[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> to, nxt, val; &#125; e[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> query[N], MaxQue;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  e[cnt].val = w;</span><br><span class="line">  head[u] = cnt; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calcsiz</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">  siz[cur] = <span class="number">1</span>, Maxi[cur] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==fa || vis[to]) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">calcsiz</span>(to, cur);</span><br><span class="line">    Maxi[cur] = <span class="built_in">max</span>(Maxi[cur], siz[to]);</span><br><span class="line">    siz[cur] += siz[to];</span><br><span class="line">  &#125;</span><br><span class="line">  Maxi[cur] = <span class="built_in">max</span>(Maxi[cur], totsiz - siz[cur]);</span><br><span class="line">  <span class="keyword">if</span> (Maxi[cur] &lt; Maxi[rt]) rt = cur;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">calcdist</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">  Dis[++tot] = dist[cur];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==fa || vis[to]) <span class="keyword">continue</span>;</span><br><span class="line">    dist[to] = dist[cur] + e[i].val;</span><br><span class="line">    <span class="built_in">calcdist</span>(to, cur);</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">queue &lt;<span class="keyword">int</span>&gt; stat;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> fa)</span> </span>&#123;</span><br><span class="line">  Exist[<span class="number">0</span>] = vis[cur] = <span class="literal">true</span>; stat.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==fa || vis[to]) <span class="keyword">continue</span>;</span><br><span class="line">    dist[to] = e[i].val;</span><br><span class="line">    <span class="built_in">calcdist</span>(to, cur);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=m; ++j)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">1</span>; k&lt;=tot; ++k)</span><br><span class="line">        <span class="keyword">if</span> (query[j]&gt;=Dis[k])</span><br><span class="line">          hasret[j] |= Exist[query[j]-Dis[k]];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=tot; ++j)</span><br><span class="line">      <span class="keyword">if</span> (Dis[j]&lt;M)</span><br><span class="line">        stat.<span class="built_in">push</span>(Dis[j]), Exist[Dis[j]] = <span class="literal">true</span>;</span><br><span class="line">    tot = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (!stat.<span class="built_in">empty</span>())</span><br><span class="line">    Exist[stat.<span class="built_in">front</span>()] = <span class="literal">false</span>, stat.<span class="built_in">pop</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==fa || vis[to]) <span class="keyword">continue</span>;</span><br><span class="line">    totsiz = siz[to], rt = <span class="number">0</span>;</span><br><span class="line">    Maxi[<span class="number">0</span>] = INT_MAX;</span><br><span class="line">    <span class="built_in">calcsiz</span>(to, cur), <span class="built_in">calcsiz</span>(rt, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">dfs</span>(rt, cur);</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(m);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> u, v, w; <span class="built_in">read</span>(u), <span class="built_in">read</span>(v), <span class="built_in">read</span>(w);</span><br><span class="line">    <span class="built_in">addEdge</span>(u, v, w), <span class="built_in">addEdge</span>(v, u, w);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; ++i)</span><br><span class="line">    <span class="built_in">read</span>(query[i]), MaxQue = <span class="built_in">max</span>(MaxQue, query[i]);</span><br><span class="line">  Maxi[<span class="number">0</span>] = INT_MAX, totsiz = n;</span><br><span class="line">  <span class="built_in">calcsiz</span>(<span class="number">1</span>, <span class="number">-1</span>); <span class="built_in">calcsiz</span>(rt, <span class="number">-1</span>); <span class="built_in">dfs</span>(rt, <span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; ++i)</span><br><span class="line">    <span class="built_in">puts</span>(hasret[i]? <span class="string">&quot;AYE&quot;</span> : <span class="string">&quot;NAY&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/09/About-Duliu-DS/"><img class="fill" src="https://tva1.sinaimg.cn/large/87c01ec7gy1fsnqqraw3fj21kw0w0ncv.jpg" alt="比较纯粹的分块线段树等 DS 趣题"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-09T14:01:53.000Z" title="2021/8/9 下午10:01:53">2021-08-09</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-09-04T15:03:14.458Z" title="2021/9/4 下午11:03:14">2021-09-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">20 minutes read (About 2993 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/09/About-Duliu-DS/">比较纯粹的分块线段树等 DS 趣题</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP1043">SP1043 GSS1</a></li>
</ul>
<p>要你求一个区间的最大子段和。<br>那么，显然地，我们可以维护区间最大前缀和和后缀和。<br>即根据左区间后缀和加上右区间前缀和可以等于最大子段和这个性质。</p>
<p>那么如何维护最大前缀和和最大后缀和呢？</p>
<p>显然一段区间分成两块，最大前缀和有可能是左区间的最大前缀和，也有可能是左区间的 Sum 加上右区间的最大前缀和，那么这样想，右区间也就没有疑问了。<br>然后正常操作即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, a[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> Lmax, Rmax, all, sum;</span><br><span class="line">&#125; t[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls ((rt)&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs ((rt)&lt;&lt;1|1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  t[rt].sum = t[ls].sum + t[rs].sum;</span><br><span class="line">  <span class="comment">// deal with Maximum Lmax</span></span><br><span class="line">  t[rt].Lmax = <span class="built_in">max</span>(t[ls].Lmax, t[ls].sum + t[rs].Lmax);</span><br><span class="line">  <span class="comment">// deal with Maximum Rmax</span></span><br><span class="line">  t[rt].Rmax = <span class="built_in">max</span>(t[rs].Rmax, t[rs].sum + t[ls].Rmax);</span><br><span class="line">  <span class="comment">// deal with the all Max</span></span><br><span class="line">  t[rt].all = t[ls].Rmax + t[rs].Lmax;</span><br><span class="line">  t[rt].all = <span class="built_in">max</span>(t[rt].all, <span class="built_in">max</span>(t[ls].all, t[rs].all));</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">seg <span class="title">pushup_ret</span><span class="params">(seg l, seg r)</span> </span>&#123;</span><br><span class="line">  seg Root; Root.sum = l.sum + r.sum;</span><br><span class="line">  <span class="comment">// deal with Maximum Lmax</span></span><br><span class="line">  Root.Lmax = <span class="built_in">max</span>(l.Lmax, l.sum + r.Lmax);</span><br><span class="line">  <span class="comment">// deal with Maximum Rmax</span></span><br><span class="line">  Root.Rmax = <span class="built_in">max</span>(r.Rmax, r.sum + l.Rmax);</span><br><span class="line">  <span class="comment">// deal with the all Max</span></span><br><span class="line">  Root.all = l.Rmax + r.Lmax;</span><br><span class="line">  Root.all = <span class="built_in">max</span>(Root.all, <span class="built_in">max</span>(l.all, r.all));</span><br><span class="line">  <span class="keyword">return</span> Root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123;</span><br><span class="line">    t[rt].all = t[rt].sum = a[l];</span><br><span class="line">    t[rt].Lmax = t[rt].Rmax = a[l];</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">build</span>(ls, l, mid), <span class="built_in">build</span>(rs, mid+<span class="number">1</span>, r);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">seg <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> t[rt];</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, tag = <span class="number">0</span>; seg ans1, ans2;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ++tag, ans1 = <span class="built_in">query</span>(ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) tag += <span class="number">2</span>, ans2 = <span class="built_in">query</span>(rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">if</span> (tag==<span class="number">1</span>) <span class="keyword">return</span> ans1; <span class="keyword">if</span> (tag==<span class="number">2</span>) <span class="keyword">return</span> ans2;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">pushup_ret</span>(ans1, ans2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(a[i]);</span><br><span class="line">  <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">  <span class="built_in">read</span>(m); <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">    <span class="keyword">int</span> l, r; <span class="built_in">read</span>(l), <span class="built_in">read</span>(r);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r).all);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP1716">SP1716 GSS3</a></li>
</ul>
<p>带修区间最大子段和。<br>。没什么好说的了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, a[N];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls ((rt)&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs ((rt)&lt;&lt;1|1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> Lmax, Rmax, sum, all;</span><br><span class="line">  <span class="built_in">seg</span>(<span class="keyword">int</span> Lmax, <span class="keyword">int</span> Rmax, <span class="keyword">int</span> sum, <span class="keyword">int</span> all):</span><br><span class="line">    <span class="built_in">Lmax</span>(Lmax), <span class="built_in">Rmax</span>(Rmax), <span class="built_in">sum</span>(sum), <span class="built_in">all</span>(all) &#123;&#125;</span><br><span class="line">  <span class="built_in">seg</span>() &#123;&#125;</span><br><span class="line">&#125; t[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  t[rt].sum = t[ls].sum + t[rs].sum;</span><br><span class="line">  t[rt].Lmax = <span class="built_in">max</span>(t[ls].Lmax, t[ls].sum+t[rs].Lmax);</span><br><span class="line">  t[rt].Rmax = <span class="built_in">max</span>(t[rs].Rmax, t[rs].sum+t[ls].Rmax);</span><br><span class="line">  t[rt].all = <span class="built_in">max</span>(t[ls].all, t[rs].all);</span><br><span class="line">  t[rt].all = <span class="built_in">max</span>(t[rt].all, t[ls].Rmax+t[rs].Lmax);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">seg <span class="title">pushup_ret</span><span class="params">(seg l, seg r)</span> </span>&#123;</span><br><span class="line">  seg ans; ans = <span class="built_in">seg</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  ans.sum = l.sum + r.sum;</span><br><span class="line">  ans.Lmax = <span class="built_in">max</span>(l.Lmax, l.sum+r.Lmax);</span><br><span class="line">  ans.Rmax = <span class="built_in">max</span>(r.Rmax, r.sum+l.Rmax);</span><br><span class="line">  ans.all = <span class="built_in">max</span>(l.all, r.all);</span><br><span class="line">  ans.all = <span class="built_in">max</span>(ans.all, l.Rmax+r.Lmax);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; t[rt] = <span class="built_in">seg</span>(a[l], a[l], a[l], a[l]); <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">build</span>(ls, l, mid), <span class="built_in">build</span>(rs, mid+<span class="number">1</span>, r);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; t[rt] = <span class="built_in">seg</span>(f, f, f, f); <span class="keyword">return</span>; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (pos&lt;=mid) <span class="built_in">upd</span>(ls, l, mid, pos, f);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">upd</span>(rs, mid+<span class="number">1</span>, r, pos, f);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">seg <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> t[rt];</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, tag = <span class="number">0</span>; seg ans1, ans2;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ++tag, ans1 = <span class="built_in">query</span>(ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) tag += <span class="number">2</span>, ans2 = <span class="built_in">query</span>(rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">if</span> (tag==<span class="number">1</span>) <span class="keyword">return</span> ans1; <span class="keyword">if</span> (tag==<span class="number">2</span>) <span class="keyword">return</span> ans2;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">pushup_ret</span>(ans1, ans2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(a[i]);</span><br><span class="line">  <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">  <span class="built_in">read</span>(m); <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, l, r; <span class="built_in">read</span>(opt);</span><br><span class="line">    <span class="built_in">read</span>(l), <span class="built_in">read</span>(r);</span><br><span class="line">    <span class="keyword">if</span> (!opt) <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r).all);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP2713">SP2713 GSS4</a></li>
</ul>
<p>Update 区间开方，Query 区间和。<br>那么根据某上帝造题的套路，因为 $\sqrt{1}=1$，所以可以维护一个区间 Max。<br>如果当前区间 Max = 1，那么直接退出循环，停止修改。<br>然后 pushdown 的时候 lazytag 下传一下。<br>没别的了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, cnt, a[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> sum, Max;</span><br><span class="line">&#125; t[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls ((rt)&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs ((rt)&lt;&lt;1|1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  t[rt].Max = <span class="built_in">max</span>(t[ls].Max, t[rs].Max);</span><br><span class="line">  t[rt].sum = t[ls].sum + t[rs].sum;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (t[rt].Max&lt;=<span class="number">1</span>) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123;</span><br><span class="line">    t[rt].sum = <span class="built_in">sqrt</span>(t[rt].sum);</span><br><span class="line">    t[rt].Max = t[rt].sum; <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) <span class="built_in">upd</span>(ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) <span class="built_in">upd</span>(rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> t[rt].sum;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans += <span class="built_in">query</span>(ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans += <span class="built_in">query</span>(rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123;</span><br><span class="line">    t[rt].sum = a[l];</span><br><span class="line">    t[rt].Max = t[rt].sum; <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">build</span>(ls, l, mid), <span class="built_in">build</span>(rs, mid+<span class="number">1</span>, r);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (cin &gt;&gt; n) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(a[i]);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n); <span class="built_in">read</span>(m);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Case #%lld:\n&quot;</span>, ++cnt);</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">      <span class="keyword">int</span> opt, l, r; <span class="built_in">read</span>(opt);</span><br><span class="line">      <span class="built_in">read</span>(l), <span class="built_in">read</span>(r); <span class="keyword">if</span> (l&gt;r) <span class="built_in">swap</span>(l, r);</span><br><span class="line">      <span class="keyword">if</span> (!opt) <span class="built_in">upd</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r);</span><br><span class="line">      <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r));</span><br><span class="line">    &#125; <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://loj.ac/p/6277">LOJ6277 数列分块1</a></li>
</ul>
<p>区修单查。<br>直接维护一个块内加法的 tag 和零散块的 tag 即可。<br>零散块为了方便可以直接加在原数组里面。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, a[N], tag[N], bel[N];</span><br><span class="line"><span class="keyword">int</span> Len, beg[N], End[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bel[l] == bel[r]) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i) a[i] += f;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i) tag[i] += f;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i) a[i] += f;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i) a[i] += f;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n); Len = <span class="built_in">sqrt</span>(n);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(a[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Len; ++i) &#123;</span><br><span class="line">    beg[i] = (i<span class="number">-1</span>) * Len + <span class="number">1</span>;</span><br><span class="line">    End[i] = i * Len;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=beg[i]; j&lt;=End[i]; ++j)</span><br><span class="line">      bel[j] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Len*Len == n) <span class="keyword">return</span> ;</span><br><span class="line">  beg[Len+<span class="number">1</span>] = Len * Len + <span class="number">1</span>, End[Len+<span class="number">1</span>] = n;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[Len+<span class="number">1</span>]; i&lt;=n; ++i) bel[i] = Len + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a[pos] + tag[bel[pos]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">init</span>();</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, l, r, c;</span><br><span class="line">    <span class="built_in">read</span>(opt), <span class="built_in">read</span>(l), <span class="built_in">read</span>(r), <span class="built_in">read</span>(c);</span><br><span class="line">    <span class="keyword">if</span> (!opt) <span class="built_in">upd</span>(l, r, c);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(r));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://loj.ac/p/6278">LOJ6278 数列分块2</a></li>
</ul>
<p>区间修改，区间查询 $&lt;k$ 的数的个数。</p>
<p>不难想到直接块内排个序就没了。<br>这个时候就要考虑零散块了。<br>因为排了序，所以原来的下标都换了位置。<br>那么我们可以暴力一点，直接在输入的数组里面进行修改，在这之后把零散块所在的区间全部重新赋值一遍，然后再块内排个序即可。可以保证这个是正确的，因为区间 tag 是区间统一加上，所以原来的相对关系都没有变，所以是对的！</p>
<p>那么要注意的是，query 的时候查询零散块要查询输入数组而非块内已排序的数组。<br>为什么？还是那个 id 变化的问题，下标不一样嘛。</p>
<p><del>我才不会告诉你就是这个问题卡了我好久</del></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">233</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, a[N], tag[M], bel[N];</span><br><span class="line"><span class="keyword">int</span> Num, Len, beg[M], End[M];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span> &#123;</span> <span class="keyword">int</span> val[M]; &#125; t[M];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bel[l] == bel[r]) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i) a[i] += f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[l]]; i&lt;=End[bel[l]]; ++i) &#123;</span><br><span class="line">      <span class="keyword">int</span> y = (i<span class="number">-1</span>) % Len + <span class="number">1</span>;</span><br><span class="line">      t[bel[l]].val[y] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> segm = End[bel[l]] - beg[bel[l]] + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">sort</span>(t[bel[l]].val+<span class="number">1</span>, t[bel[l]].val+<span class="number">1</span>+segm);</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i) tag[i] += f;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i) a[i] += f;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i) a[i] += f;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[l]]; i&lt;=End[bel[l]]; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> y = (i<span class="number">-1</span>) % Len + <span class="number">1</span>;</span><br><span class="line">    t[bel[l]].val[y] = a[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=End[bel[r]]; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> y = (i<span class="number">-1</span>) % Len + <span class="number">1</span>;</span><br><span class="line">    t[bel[r]].val[y] = a[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> segml = End[bel[l]] - beg[bel[l]] + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">sort</span>(t[bel[l]].val+<span class="number">1</span>, t[bel[l]].val+<span class="number">1</span>+segml);</span><br><span class="line">  <span class="keyword">int</span> segmr = End[bel[r]] - beg[bel[r]] + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">sort</span>(t[bel[r]].val+<span class="number">1</span>, t[bel[r]].val+<span class="number">1</span>+segmr);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n); Len = <span class="built_in">sqrt</span>(n); Num = n/Len;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> x = (i<span class="number">-1</span>) / Len + <span class="number">1</span>, y = (i<span class="number">-1</span>) % Len + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">read</span>(t[x].val[y]); a[i] = t[x].val[y];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i) &#123;</span><br><span class="line">    beg[i] = (i<span class="number">-1</span>) * Len + <span class="number">1</span>;</span><br><span class="line">    End[i] = i * Len;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=beg[i]; j&lt;=End[i]; ++j) bel[j] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (End[Num]==n) <span class="keyword">return</span> ; <span class="keyword">else</span> ++Num;</span><br><span class="line">  beg[Num] = End[Num<span class="number">-1</span>] + <span class="number">1</span>, End[Num] = n;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[Num]; i&lt;=n; ++i) bel[i] = Num;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> Lim)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// checking for updates</span></span><br><span class="line">  <span class="keyword">if</span> (bel[l] == bel[r]) &#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i)</span><br><span class="line">      <span class="keyword">if</span> (a[i] + tag[bel[l]] &lt; Lim) ++cnt;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i)</span><br><span class="line">    ans += ((<span class="built_in">lower_bound</span>(t[i].val+<span class="number">1</span>, t[i].val+<span class="number">1</span>+Len, Lim-tag[i])-t[i].val)<span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i)</span><br><span class="line">    <span class="keyword">if</span> (a[i] + tag[bel[l]] &lt; Lim) ++ans;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i)</span><br><span class="line">    <span class="keyword">if</span> (a[i] + tag[bel[r]] &lt; Lim) ++ans;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// freopen(&quot;fk2.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="comment">// freopen(&quot;fk2.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">  <span class="built_in">init</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> segm = End[i] - beg[i] + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">sort</span>(t[i].val+<span class="number">1</span>, t[i].val+segm+<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, l, r, c;</span><br><span class="line">    <span class="built_in">read</span>(opt), <span class="built_in">read</span>(l), <span class="built_in">read</span>(r), <span class="built_in">read</span>(c);</span><br><span class="line">    <span class="keyword">if</span> (!opt) <span class="built_in">upd</span>(l, r, c);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(l, r, c*c));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://loj.ac/p/6279">LOJ6279 数列分块3</a></li>
</ul>
<p>区间加法，区间前驱。</p>
<p>简单题。每一次区间加法直接加到 tag 里面去。<br>然后区间前驱对于每一个块都扫一遍 <code>lower_bound</code>。<br>接着零散块暴力扫。取一个 Max 即可。</p>
<p>注意零散块扫的是原来的数组，update 完之后要重新更新左右两个块。<br>以及不要忘记在求前驱的时候加上 <code>tag</code>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">350</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, Len, Num, beg[M], End[M];</span><br><span class="line"><span class="keyword">int</span> a[N], tag[M], bel[N];</span><br><span class="line"><span class="keyword">int</span> Length[M], seg[M][M];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n); Len = <span class="built_in">sqrt</span>(n), Num = n / Len;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(a[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i) &#123;</span><br><span class="line">    beg[i] = Len*(i<span class="number">-1</span>)+<span class="number">1</span>, End[i] = Len*i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=beg[i]; j&lt;=End[i]; ++j)</span><br><span class="line">      bel[j] = i, seg[i][(j<span class="number">-1</span>)%Len+<span class="number">1</span>] = a[j];</span><br><span class="line">    Length[i] = Len;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (End[Num]==n) <span class="keyword">return</span> ; ++Num;</span><br><span class="line">  beg[Num] = End[Num<span class="number">-1</span>] + <span class="number">1</span>, End[Num] = n;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[Num]; i&lt;=End[Num]; ++i)</span><br><span class="line">    bel[i] = Num, seg[Num][(i<span class="number">-1</span>)%Len+<span class="number">1</span>] = a[i];</span><br><span class="line">  Length[Num] = End[Num] - beg[Num] + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bel[l]==bel[r]) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i) a[i] += f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[l]]; i&lt;=End[bel[r]]; ++i)</span><br><span class="line">      seg[bel[l]][(i<span class="number">-1</span>)%Len+<span class="number">1</span>] = a[i];</span><br><span class="line">    <span class="built_in">sort</span>(seg[bel[l]]+<span class="number">1</span>, seg[bel[l]]+<span class="number">1</span>+Length[bel[l]]);</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i) tag[i] += f;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i) a[i] += f;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i) a[i] += f;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[l]]; i&lt;=End[bel[l]]; ++i)</span><br><span class="line">    seg[bel[l]][(i<span class="number">-1</span>)%Len+<span class="number">1</span>] = a[i];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=End[bel[r]]; ++i)</span><br><span class="line">    seg[bel[r]][(i<span class="number">-1</span>)%Len+<span class="number">1</span>] = a[i];</span><br><span class="line">  <span class="built_in">sort</span>(seg[bel[l]]+<span class="number">1</span>, seg[bel[l]]+<span class="number">1</span>+Length[bel[l]]);</span><br><span class="line">  <span class="built_in">sort</span>(seg[bel[r]]+<span class="number">1</span>, seg[bel[r]]+<span class="number">1</span>+Length[bel[r]]);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bel[l]==bel[r]) &#123;</span><br><span class="line">    <span class="keyword">int</span> Max = <span class="number">-1e18</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i)</span><br><span class="line">      <span class="keyword">if</span> (a[i]+tag[bel[i]]&lt;x) Max = <span class="built_in">max</span>(Max, a[i]+tag[bel[i]]);</span><br><span class="line">    <span class="keyword">return</span> (Max==<span class="number">-1e18</span>)? <span class="number">-1</span>:Max;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> Max = <span class="number">-1e18</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = <span class="built_in">lower_bound</span>(seg[i]+<span class="number">1</span>, seg[i]+<span class="number">1</span>+Length[i], x-tag[i])-seg[i]<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (!cur) <span class="keyword">continue</span>; Max = <span class="built_in">max</span>(Max, seg[i][cur]+tag[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i)</span><br><span class="line">    <span class="keyword">if</span> (a[i]+tag[bel[i]]&lt;x) Max = <span class="built_in">max</span>(Max, a[i]+tag[bel[i]]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i)</span><br><span class="line">    <span class="keyword">if</span> (a[i]+tag[bel[i]]&lt;x) Max = <span class="built_in">max</span>(Max, a[i]+tag[bel[i]]);</span><br><span class="line">  <span class="keyword">return</span> (Max==<span class="number">-1e18</span>)? <span class="number">-1</span>:Max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// freopen(&quot;fk3.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="comment">// freopen(&quot;fk3.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">  <span class="built_in">init</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i)</span><br><span class="line">    <span class="built_in">sort</span>(seg[i]+<span class="number">1</span>, seg[i]+<span class="number">1</span>+Length[i]);</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, L, R, c; <span class="built_in">read</span>(opt);</span><br><span class="line">    <span class="built_in">read</span>(L), <span class="built_in">read</span>(R), <span class="built_in">read</span>(c);</span><br><span class="line">    <span class="keyword">if</span> (!opt) <span class="built_in">upd</span>(L, R, c);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">query</span>(L, R, c));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://loj.ac/p/6280">LOJ6280 数列分块4</a></li>
</ul>
<p>区间加法，区间求和。<br>直接记录一下块内的和 Sum 即可。<br>然后维护一个 tag，和原数组 a，查询暴力查询即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">233</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, Len, Num, a[N], tag[M], add[M];</span><br><span class="line"><span class="keyword">int</span> beg[M], End[M], Length[M], bel[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n); Len = <span class="built_in">sqrt</span>(n); Num = n / Len;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(a[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i) &#123;</span><br><span class="line">    beg[i] = (i<span class="number">-1</span>)*Len+<span class="number">1</span>, End[i] = i*Len, Length[i] = Len;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=beg[i]; j&lt;=End[i]; ++j)</span><br><span class="line">      bel[j] = i, add[i] += a[j];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (Len*Num==n) <span class="keyword">return</span>; ++Num;</span><br><span class="line">  beg[Num] = End[Num<span class="number">-1</span>]+<span class="number">1</span>, End[Num] = n;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[Num]; i&lt;=End[Num]; ++i)</span><br><span class="line">    bel[i] = Num, add[Num] += a[i];</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bel[l]==bel[r]) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i) a[i] += x;</span><br><span class="line">    add[bel[l]] += x*(r-l+<span class="number">1</span>); <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i)</span><br><span class="line">    tag[i] += x, add[i] += x*Len;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i) a[i] += x;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i) a[i] += x;</span><br><span class="line">  add[bel[l]] += x*(End[bel[l]]-l+<span class="number">1</span>);</span><br><span class="line">  add[bel[r]] += x*(r-beg[bel[r]]+<span class="number">1</span>);</span><br><span class="line">  <span class="comment">/* cout &lt;&lt; &quot;TAG: &quot;; for (int i=1; i&lt;=Num; ++i) cout &lt;&lt; tag[i] &lt;&lt; &#x27; &#x27;;</span></span><br><span class="line"><span class="comment">  cout &lt;&lt; endl &lt;&lt; &quot;ADD: &quot;; for (int i=1; i&lt;=Num; ++i) cout &lt;&lt; add[i] &lt;&lt; &#x27; &#x27;;</span></span><br><span class="line"><span class="comment">  cout &lt;&lt; endl; */</span></span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> Mod)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bel[l]==bel[r]) &#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i) sum += (a[i] + tag[bel[l]]);</span><br><span class="line">    <span class="keyword">return</span> (sum%Mod + Mod) % Mod;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i)</span><br><span class="line">    sum = (sum+add[i]) % Mod;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i)</span><br><span class="line">    sum = (sum+tag[bel[l]]+a[i]) % Mod;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i)</span><br><span class="line">    sum = (sum+tag[bel[r]]+a[i]) % Mod;</span><br><span class="line">  <span class="keyword">return</span> (sum%Mod + Mod) % Mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">init</span>();</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, L, R, x; <span class="built_in">read</span>(opt);</span><br><span class="line">    <span class="built_in">read</span>(L), <span class="built_in">read</span>(R), <span class="built_in">read</span>(x);</span><br><span class="line">    <span class="keyword">if</span> (!opt) <span class="built_in">upd</span>(L, R, x);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">query</span>(L, R, x+<span class="number">1</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://loj.ac/p/6281">LOJ6281 数列分块5</a></li>
</ul>
<p>区间开方，区间求和。<br>因为一个数最多被开方多少多少次（懒得算），所以直接类比线段树做法。<br>对于每一个块如果 Max $\le 1$ 了直接跳过，根本不需要开方。<br>否则直接暴力修改整个块，更新 Sum 数组即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">233</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, Len, Num, beg[M], End[N], Max[M];</span><br><span class="line"><span class="keyword">int</span> Length[M], a[N], add[M], bel[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n); Len = <span class="built_in">sqrt</span>(n), Num = n / Len;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">read</span>(a[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i) &#123;</span><br><span class="line">    beg[i] = (i<span class="number">-1</span>)*Len+<span class="number">1</span>, End[i] = i*Len;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=beg[i]; j&lt;=End[i]; ++j)</span><br><span class="line">      bel[j] = i, add[i] += a[j], Max[i] = <span class="built_in">max</span>(Max[i], a[j]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (End[Num]==n) <span class="keyword">return</span> ; ++Num;</span><br><span class="line">  beg[Num] = End[Num<span class="number">-1</span>] + <span class="number">1</span>, End[Num] = n;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[Num]; i&lt;=End[Num]; ++i)</span><br><span class="line">    bel[i] = Num, add[Num] += a[i], Max[Num] = <span class="built_in">max</span>(Max[Num], a[i]);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bel[l]==bel[r]) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i) &#123;</span><br><span class="line">      <span class="keyword">int</span> to = <span class="built_in">sqrt</span>(a[i]);</span><br><span class="line">      add[bel[l]] += to - a[i], a[i] = to;</span><br><span class="line">    &#125;</span><br><span class="line">    Max[bel[l]] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[l]]; i&lt;=End[bel[l]]; ++i)</span><br><span class="line">      Max[bel[l]] = <span class="built_in">max</span>(Max[bel[l]], a[i]);</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = <span class="built_in">sqrt</span>(a[i]);</span><br><span class="line">    add[bel[l]] += to - a[i], a[i] = to;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[l]]; i&lt;=End[bel[l]]; ++i)</span><br><span class="line">    Max[bel[l]] = <span class="built_in">max</span>(Max[bel[l]], a[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = <span class="built_in">sqrt</span>(a[i]);</span><br><span class="line">    add[bel[r]] += to - a[i], a[i] = to;</span><br><span class="line">    Max[bel[r]] = <span class="built_in">max</span>(Max[bel[r]], to);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=End[bel[r]]; ++i)</span><br><span class="line">    Max[bel[r]] = <span class="built_in">max</span>(Max[bel[r]], a[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (Max[i]&lt;=<span class="number">1</span>) <span class="keyword">continue</span>; Max[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=beg[i]; j&lt;=End[i]; ++j) &#123;</span><br><span class="line">      <span class="keyword">int</span> to = <span class="built_in">sqrt</span>(a[j]);</span><br><span class="line">      add[i] += to - a[j], a[j] = to;</span><br><span class="line">      Max[i] = <span class="built_in">max</span>(Max[i], to);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bel[l]==bel[r]) &#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i) sum += a[i];</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i) sum += add[i];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i) sum += a[i];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i) sum += a[i];</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">init</span>();</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, L, R, x; <span class="built_in">read</span>(opt);</span><br><span class="line">    <span class="built_in">read</span>(L), <span class="built_in">read</span>(R), <span class="built_in">read</span>(x);</span><br><span class="line">    <span class="keyword">if</span> (!opt) <span class="built_in">upd</span>(L, R);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">query</span>(L, R));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://loj.ac/p/6282">LOJ6282 数列分块6</a></li>
</ul>
<p>单点插入，单点查询。</p>
<p>对于每一个块维护一个 vector 和 siz。<br>然后对于每一个插入操作，直接插入 vector 即可，siz 更新。<br>单点查询只要将查询的 id 遍历一遍减掉 siz 看什么时候满足当前 siz 即可。<br>插入操作也是一样。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">350</span>;</span><br><span class="line"></span><br><span class="line">vector &lt;<span class="keyword">int</span>&gt; seg[M];</span><br><span class="line"><span class="keyword">int</span> n, Len, Num, bel[N], beg[M];</span><br><span class="line"><span class="keyword">int</span> End[M], Length[M];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ins insert</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n); Len = <span class="built_in">sqrt</span>(n), Num = n / Len;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i) &#123;</span><br><span class="line">    beg[i] = (i<span class="number">-1</span>)*Len + <span class="number">1</span>, End[i] = i*Len;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=beg[i]; j&lt;=End[i]; ++j) &#123;</span><br><span class="line">      <span class="keyword">int</span> x; <span class="built_in">read</span>(x); seg[i].<span class="built_in">pb</span>(x);</span><br><span class="line">      bel[j] = i;</span><br><span class="line">    &#125; Length[i] = Len;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (End[Num]==n) <span class="keyword">return</span> ; ++Num;</span><br><span class="line">  beg[Num] = End[Num<span class="number">-1</span>] + <span class="number">1</span>, End[Num] = n;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[Num]; i&lt;=End[Num]; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> x; <span class="built_in">read</span>(x); seg[Num].<span class="built_in">pb</span>(x);</span><br><span class="line">    bel[i] = Num;</span><br><span class="line">  &#125; Length[Num] = n - beg[Num] + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pos&lt;=Length[i]) &#123;</span><br><span class="line">      seg[i].<span class="built_in">ins</span>(seg[i].<span class="built_in">begin</span>()+pos<span class="number">-1</span>, x);</span><br><span class="line">      ++Length[i]; <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    pos -= Length[i];</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pos&lt;=Length[i]) <span class="keyword">return</span> seg[i][pos<span class="number">-1</span>];</span><br><span class="line">    pos -= Length[i];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">init</span>();</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, L, R, x; <span class="built_in">read</span>(opt);</span><br><span class="line">    <span class="built_in">read</span>(L), <span class="built_in">read</span>(R), <span class="built_in">read</span>(x);</span><br><span class="line">    <span class="keyword">if</span> (!opt) <span class="built_in">upd</span>(L, R);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(R));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://loj.ac/p/6283">LOJ6283 数列分块7</a></li>
</ul>
<p>区间加，区间乘，单点查询。<br>直接参考线段树加法乘法操作即可。<br>首先优先级肯定乘法大于加法，所以考虑维护两个 tag。<br>即 addtag 和 multag。<br>然后区间加和区间乘最重要的就是类似于 pushdown 之类的东西。<br>就是根据优先级直接将当前区间标记下放乱搞即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>(); <span class="keyword">int</span> f = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch) &amp;&amp; ch^<span class="string">&#x27;-&#x27;</span>) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">if</span> (ch==<span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>, ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; ret *= f; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">350</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Mod = <span class="number">1e4</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, Len, Num, a[N], bel[N];</span><br><span class="line"><span class="keyword">int</span> addtag[M], multag[M];</span><br><span class="line"><span class="keyword">int</span> beg[M], End[M], Length[M];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n); Len = <span class="built_in">sqrt</span>(n), Num = n / Len;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num+<span class="number">1</span>; ++i) multag[i] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=Num; ++i) &#123;</span><br><span class="line">    beg[i] = (i<span class="number">-1</span>)*Len+<span class="number">1</span>, End[i] = i*Len;</span><br><span class="line">    Length[i] = End[i] - beg[i] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=beg[i]; j&lt;=End[i]; ++j)</span><br><span class="line">      <span class="built_in">read</span>(a[j]), bel[j] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (End[Num]==n) <span class="keyword">return</span> ; ++Num;</span><br><span class="line">  beg[Num] = End[Num<span class="number">-1</span>] + <span class="number">1</span>, End[Num] = n;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[Num]; i&lt;=End[Num]; ++i)</span><br><span class="line">    <span class="built_in">read</span>(a[i]), bel[i] = Num;</span><br><span class="line">  <span class="keyword">return</span> ;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[x]; i&lt;=End[x]; ++i)</span><br><span class="line">    a[i] = (a[i] * multag[x] + addtag[x]) % Mod;</span><br><span class="line">  multag[x] = <span class="number">1</span>, addtag[x] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x, <span class="keyword">bool</span> opt)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bel[l]==bel[r]) &#123;</span><br><span class="line">    <span class="built_in">reset</span>(bel[l]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=r; ++i)</span><br><span class="line">      <span class="keyword">if</span> (!opt) a[i] = (a[i] + x) % Mod;</span><br><span class="line">      <span class="keyword">else</span> a[i] = (a[i] * x) % Mod;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">reset</span>(bel[l]), <span class="built_in">reset</span>(bel[r]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=bel[l]+<span class="number">1</span>; i&lt;bel[r]; ++i)</span><br><span class="line">    <span class="keyword">if</span> (!opt) addtag[i] = (addtag[i] + x) % Mod;</span><br><span class="line">    <span class="keyword">else</span> addtag[i] = (addtag[i] * x) % Mod,</span><br><span class="line">        multag[i] = (multag[i] * x) % Mod;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=l; i&lt;=End[bel[l]]; ++i)</span><br><span class="line">    <span class="keyword">if</span> (!opt) a[i] = (a[i] + x) % Mod;</span><br><span class="line">    <span class="keyword">else</span> a[i] = (a[i] * x) % Mod;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=beg[bel[r]]; i&lt;=r; ++i)</span><br><span class="line">    <span class="keyword">if</span> (!opt) a[i] = (a[i] + x) % Mod;</span><br><span class="line">    <span class="keyword">else</span> a[i] = (a[i] * x) % Mod;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (a[x] * multag[bel[x]] + addtag[bel[x]]) % Mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">init</span>();</span><br><span class="line">  <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">    <span class="keyword">int</span> opt, L, R, x; <span class="built_in">read</span>(opt);</span><br><span class="line">    <span class="built_in">read</span>(L), <span class="built_in">read</span>(R), <span class="built_in">read</span>(x);</span><br><span class="line">    <span class="keyword">if</span> (opt==<span class="number">2</span>) <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">query</span>(R));</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">upd</span>(L, R, x, opt);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/07/Interesting-Faults/"><img class="fill" src="https://tva3.sinaimg.cn/large/87c01ec7gy1fsnqqelvgkj21kw0w0qgi.jpg" alt="比较奇妙的小错误"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-07T08:57:38.000Z" title="2021/8/7 下午4:57:38">2021-08-07</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-09-04T15:05:16.205Z" title="2021/9/4 下午11:05:16">2021-09-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">a minute read (About 168 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/07/Interesting-Faults/">比较奇妙的小错误</a></h1><div class="content">Here's something encrypted, password is required to continue reading.</div><a class="article-more button is-small is-size-7" href="/2021/08/07/Interesting-Faults/#more">Read more</a></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/04/About-Dynamic-Point-Segment-Tree/"><img class="fill" src="https://tva3.sinaimg.cn/large/87c01ec7gy1fsnqr0wz1tj21kw0w0h3l.jpg" alt="关于动态开点线段树的应用"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-04T14:40:09.000Z" title="2021/8/4 下午10:40:09">2021-08-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-09-04T15:03:38.156Z" title="2021/9/4 下午11:03:38">2021-09-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">10 minutes read (About 1480 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/04/About-Dynamic-Point-Segment-Tree/">关于动态开点线段树的应用</a></h1><div class="content"><p>自己瞎取的名字，就是动态开点线段树。<br>大概思想当空间不够用的时候，随时可以删点和新建点，比较灵活。<br>下面是几个例子，有的是值域线段树，有的是普通坐标的线段树。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1908">P1908 逆序对</a></li>
</ul>
<p>本来是树状数组水题，现在变成了奇怪的动态开点值域线段树模板题。<br>其实不用值域线段树也可以。<br>普通线段树就要离散化然后按照单调递增的顺序加 value，再 query。<br>多麻烦啊，所以一个值域线段树解决问题。</p>
<p>因为最大值 <code>MAX</code> 为 $10^9$，所以 <code>inf</code> 设为 $10^9$。<br>因为每一次查询的是当前点往右的点数，所以要特判 <code>l&gt;r</code> 的情况。<br>因为 <code>inf=1e9</code>，所以查询 <code>1e9+1</code> 就会炸掉，所以要特判。<br><del>其实把 <code>inf</code> 变成 <code>1e9+10</code> 不是一样的吗</del></p>
<p>那么代码如下。</p>
<p>因为线段树平均链深度为 $\log$ 级别。<br>所以开 $N \log N$ 大小的线段树。<br>动态开点线段树的优势在这道题还真没体现出来（</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e7</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf = <span class="number">1e9</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, cnt, root, tree[N];</span><br><span class="line"><span class="keyword">int</span> a[N], ls[N], rs[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> &amp;rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> val, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!rt) rt = ++cnt;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; tree[rt] += f; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (val&lt;=mid) <span class="built_in">upd</span>(ls[rt], l, mid, val, f);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">upd</span>(rs[rt], mid+<span class="number">1</span>, r, val, f);</span><br><span class="line">  tree[rt] = tree[ls[rt]] + tree[rs[rt]];</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!rt) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> tree[rt];</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans += <span class="built_in">query</span>(ls[rt], l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans += <span class="built_in">query</span>(rs[rt], mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n); ll ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> x; <span class="built_in">read</span>(x);</span><br><span class="line">    ans += (ll)<span class="built_in">query</span>(root, <span class="number">1</span>, inf, x+<span class="number">1</span>, inf);</span><br><span class="line">    <span class="built_in">upd</span>(root, <span class="number">1</span>, inf, x, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跑了 4s 多，还不如写普通线段树（bu</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3313">P3313 旅行</a></li>
</ul>
<p>虽然是个紫题，但是是个水紫。</p>
<p>首先问题可以简化成树上染色问题，四个 option 变成下面这样。</p>
<ul>
<li>某个节点被重新染色</li>
<li>节点权值被修改</li>
<li>求路径上某种颜色权值和</li>
<li>求路径上某种颜色最大权值</li>
</ul>
<p>那么考虑对于每一个颜色开一棵动态开点线段树。<br>然后直接树链剖分乱搞。（轻重链剖分）<br>对于 option 3 和 4 随便乱搞都可以过。</p>
<p>但是对于 option 1，可以转化为在树中删点，再丢到另一棵树里。<br>option 2 直接修改当前权值即可。</p>
<p>所以想到 pushup 操作。<br>可以将节点的 MAX 和 SUM 直接变成 0。<br>接着删点（就这么做！）跑路。<br>然后在另一棵树里面新建节点，只需要丢进去即可。<br>然后修改颜色（即要修改节点所属树根）。<br>或者是修改当前的权值。注意要 remove 和 update 之后做。</p>
<p>然后就没了。</p>
<p>似乎并不毒瘤？</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_SIZE = <span class="number">2e7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, Q, cnt, tot<span class="comment">/*build-cnt*/</span>, idx;</span><br><span class="line"><span class="keyword">int</span> w[MAXN], c[MAXN], wl[MAXN], wc[MAXN];</span><br><span class="line"><span class="keyword">int</span> dep[MAXN], siz[MAXN], fa[MAXN], son[MAXN];</span><br><span class="line"><span class="keyword">int</span> tp[MAXN], root[MAXN], id[MAXN];</span><br><span class="line"><span class="keyword">char</span> opt[<span class="number">3</span>]; <span class="keyword">int</span> head[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span> <span class="keyword">int</span> to, nxt; &#125; e[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  head[u] = cnt; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">  fa[cur] = f, siz[cur] = <span class="number">1</span>;</span><br><span class="line">  dep[cur] = dep[f] + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">int</span> heavyson = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to == f) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs1</span>(to, cur), siz[cur] += siz[to];</span><br><span class="line">    <span class="keyword">if</span> (siz[to] &gt; heavyson)</span><br><span class="line">      heavyson = siz[to], son[cur] = to;</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> Tp)</span> </span>&#123;</span><br><span class="line">  tp[cur] = Tp, id[cur] = ++idx;</span><br><span class="line">  <span class="keyword">if</span> (!son[cur]) <span class="keyword">return</span> ;</span><br><span class="line">  <span class="built_in">dfs2</span>(son[cur], Tp);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; i; i=e[i].nxt) &#123;</span><br><span class="line">    <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">    <span class="keyword">if</span> (to==fa[cur] || to==son[cur]) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(to, to);</span><br><span class="line">  &#125; <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span> &#123;</span> <span class="keyword">int</span> ls, rs, Max, val; &#125; tree[MAX_SIZE];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">  tree[rt].val = tree[tree[rt].ls].val + tree[tree[rt].rs].val;</span><br><span class="line">  tree[rt].Max = <span class="built_in">max</span>(tree[tree[rt].ls].Max, tree[tree[rt].rs].Max);</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">upd</span><span class="params">(<span class="keyword">int</span> &amp;rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!rt) rt = ++tot;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; tree[rt].val = tree[rt].Max = W; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (pos&lt;=mid) <span class="built_in">upd</span>(tree[rt].ls, l, mid, pos, W);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">upd</span>(tree[rt].rs, mid+<span class="number">1</span>, r, pos, W);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remv</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (l==r) &#123; tree[rt].val = tree[rt].Max = <span class="number">0</span>; <span class="keyword">return</span> ; &#125;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (pos&lt;=mid) <span class="built_in">remv</span>(tree[rt].ls, l, mid, pos);</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">remv</span>(tree[rt].rs, mid+<span class="number">1</span>, r, pos);</span><br><span class="line">  <span class="built_in">pushup</span>(rt); <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">querys</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> tree[rt].val;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans += <span class="built_in">querys</span>(tree[rt].ls, l, mid, L, R);</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans += <span class="built_in">querys</span>(tree[rt].rs, mid+<span class="number">1</span>, r, L, R);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">querym</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> tree[rt].Max;</span><br><span class="line">  <span class="keyword">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (L&lt;=mid) ans = <span class="built_in">max</span>(ans, <span class="built_in">querym</span>(tree[rt].ls, l, mid, L, R));</span><br><span class="line">  <span class="keyword">if</span> (R&gt;mid) ans = <span class="built_in">max</span>(ans, <span class="built_in">querym</span>(tree[rt].rs, mid+<span class="number">1</span>, r, L, R));</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qus</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> rel)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    ans += <span class="built_in">querys</span>(root[rel], <span class="number">1</span>, n, id[tp[l]], id[l]);</span><br><span class="line">    l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  ans += <span class="built_in">querys</span>(root[rel], <span class="number">1</span>, n, id[l], id[r]);</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qum</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> rel)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (tp[l] ^ tp[r]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dep[tp[l]] &lt; dep[tp[r]]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">    ans = <span class="built_in">max</span>(ans, <span class="built_in">querym</span>(root[rel], <span class="number">1</span>, n, id[tp[l]], id[l]));</span><br><span class="line">    l = fa[tp[l]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (dep[l] &gt; dep[r]) <span class="built_in">swap</span>(l, r);</span><br><span class="line">  ans = <span class="built_in">max</span>(ans, <span class="built_in">querym</span>(root[rel], <span class="number">1</span>, n, id[l], id[r]));</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(Q);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="built_in">read</span>(w[i]), <span class="built_in">read</span>(c[i]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> u, v; <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">    <span class="built_in">addEdge</span>(u, v);</span><br><span class="line">    <span class="built_in">addEdge</span>(v, u);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="built_in">upd</span>(root[c[i]], <span class="number">1</span>, n, id[i], w[i]);</span><br><span class="line">  <span class="keyword">while</span> (Q--) &#123;</span><br><span class="line">    cin &gt;&gt; opt+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> u, v; <span class="built_in">read</span>(u), <span class="built_in">read</span>(v);</span><br><span class="line">    <span class="keyword">if</span> (opt[<span class="number">2</span>] == <span class="string">&#x27;C&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">remv</span>(root[c[u]], <span class="number">1</span>, n, id[u]);</span><br><span class="line">      <span class="built_in">upd</span>(root[v], <span class="number">1</span>, n, id[u], w[u]);</span><br><span class="line">      c[u] = v;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (opt[<span class="number">2</span>] == <span class="string">&#x27;W&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">remv</span>(root[c[u]], <span class="number">1</span>, n, id[u]);</span><br><span class="line">      <span class="built_in">upd</span>(root[c[u]], <span class="number">1</span>, n, id[u], v);</span><br><span class="line">      w[u] = v;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (opt[<span class="number">2</span>] == <span class="string">&#x27;S&#x27;</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">qus</span>(u, v, c[u]));</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (opt[<span class="number">2</span>] == <span class="string">&#x27;M&#x27;</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">qum</span>(u, v, c[u]));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/04/CF961G-Solution/"><img class="fill" src="https://tva1.sinaimg.cn/large/87c01ec7gy1fsnqqf3pp6j21kw0w016c.jpg" alt="CF961G Solution"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-04T04:35:39.000Z" title="2021/8/4 下午12:35:39">2021-08-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-05T06:48:00.382Z" title="2021/8/5 下午2:48:00">2021-08-05</time></span><span class="level-item"><a class="link-muted" href="/categories/Sol/">Sol</a></span><span class="level-item">10 minutes read (About 1456 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/04/CF961G-Solution/">CF961G Solution</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF961G">CF961G Partitions</a></li>
</ul>
<p>这题好神啊 … 我发现我一直 WA5 的原因是开始统计和的时候没有取模（<br>然后就想着写篇题解记录一下 …</p>
<p>首先题目不是要求一个和吗。</p>
<p>那么通过人类智慧发现很显然所有数出现的次数都是一样的。<br>也就是说最后的和式必然是 $…\times \sum\limits_{i=1}^nw_i$ 这样的形式。</p>
<p>那么不妨将前面的系数设为 $p$。</p>
<p>我们对于这个问题其实可以用 DP 的思想来解决。<br>我们对于求整个柿子的系数，直接考虑枚举子集大小。<br>然后就可以发现我们当前选了 $i$ 个，然后算出自己集合的方案和别的集合的方案即可。<br>最后相乘累加就是答案，其中运用的是第二类斯特林数的思想。</p>
<p>第二类斯特林数就解决的是这样一类问题：</p>
<ul>
<li>$n$ 个物品放入 $m$ 个不同集合中，求集合非空的总方案数。</li>
</ul>
<p>想要研究的同学可以自行研究，这里不再赘述。</p>
<p>所以就可以得到系数 $p$ 变成了下面的柿子。</p>
<p>$$p=\sum\limits_{i=1}^ni\binom{n-1}{i-1}S_2(n-i,k-1)$$<br>$$=\sum\limits_{i=1}^ni\binom{n-1}{i-1}\dfrac{1}{(k-1)!}\sum\limits_{j=0}^{k-1}(-1)^j\binom{k-1}{j}(k-j-1)^{n-i}$$<br>$$=\sum\limits_{i=1}^ni\binom{n-1}{i-1}\dfrac{1}{(k-1)!}\sum\limits_{j=0}^{k-1}(-1)^j\dfrac{(k-1)!}{j!\times(k-j-1)!}(k-j-1)^{n-i}$$<br>$$=\sum\limits_{i=1}^ni\binom{n-1}{i-1}\sum\limits_{j=0}^{k-1}\dfrac{(-1)^j(k-j-1)^{n-i}}{j!\times(k-j-1)!}$$<br>$$=\sum\limits_{j=0}^{k-1}\dfrac{(-1)^j}{j!\times(k-j-1)!}\sum\limits_{i=1}^ni\binom{n-1}{i-1}(k-j-1)^{n-i}$$</p>
<p>注意上面将 $j$ 的和式提前了，这显然是正确的。<br>因为分母相同相加分母不变，然后 $-1$ 的系数显然只和 $j$ 有关。<br>但是分子剩下的部分 $(k-j-1)^{n-i}$ 显然和 $i$ 和 $j$ 都有关。<br>所以为了方便后面的推导，这里直接将 $j$ 提前作为后面那一堆和的系数。<br>这里说的 <strong>方便推导</strong> 其实也没有什么非常清晰的界定，只是这部分可以简单解决。<br>当然不排除有暴力老哥直接卷的情况。（<br>其实我也不知道可不可以卷，因为我没学多项式（（</p>
<p>所以看到一大堆阶乘，在保证答案正确性的情况下，直接从一大堆柿子里面拎出来是必要的。</p>
<p>然后后面那个 $(k-j-1)$ 看起来特别丑，弄成 $s$。</p>
<p>$$\sum\limits_{i=1}^ni\binom{n-1}{i-1}s^{n-i}$$<br>$$=\sum\limits_{i=1}^ni\times s^{n-i}\dfrac{(n-1)!}{(i-1)! \times (n-i)!}$$</p>
<p>为了约分上面的组合数拆开了。</p>
<p>然后有一个 trick，<br>看到分母有一个 $i-1$，看到前面的系数 $i$，<br>所以把那个 $i$ 给拆掉，拆成 $i=i-1+1$。</p>
<p>所以有</p>
<p>$$=\sum\limits_{i=1}^ns^{n-i}\times(i-1+1)\dfrac{(n-1)!}{(i-1)! \times (n-i)!}$$<br>$$=\sum\limits_{i=1}^ns^{n-i}[(i-1)\times \dfrac{(n-1)!}{(i-1)! \times (n-i)!}+\dfrac{(n-1)!}{(i-1)! \times (n-i)!}]$$<br>$$=\sum\limits_{i=1}^ns^{n-i}(i-1)\dfrac{(n-1)!}{(i-1)! \times (n-i)!}+\sum\limits_{i=1}^ns^{n-i}\dfrac{(n-1)!}{(i-1)! \times (n-i)!}$$</p>
<p>然后约掉共同的 $i-1$。</p>
<p>$$=\sum\limits_{i=1}^ns^{n-i}\dfrac{(n-1)!}{(i-2)! \times (n-i)!}+\sum\limits_{i=1}^n\dfrac{(n-1)!}{(i-1)! \times (n-i)!}$$</p>
<p>再重新写成方便的组合数形式。</p>
<p>$$=\sum\limits_{i=1}^ns^{n-i}\binom{n-1}{i-2}+\sum_{i=1}^ns^{n-i}\binom{n-1}{i-1}$$</p>
<p>由于这个上下不统一所以把 $(n-1)$ 提出来。</p>
<p>$$=(n-1)\sum\limits_{i=1}^ns^{n-i}\binom{n-2}{i-2}+\sum\limits_{i=1}^ns^{n-i}\binom{n-1}{i-1}$$</p>
<p>然后发现这个玩意儿好像很不好算，<br>所以变成下面这样，因为 $\binom{n}{m}=\binom{n}{n-m}$。</p>
<p>$$=(n-1)\sum\limits_{i=1}^ns^{n-i}\binom{n-2}{n-i}+\sum\limits_{i=1}^ns^{n-i}\binom{n-1}{n-i}$$</p>
<p>然后根据那个什么柿子的展开，就是杨辉三角的系数，<br>观察到 $n-i$ 的共同部分可以运用上这个公式，<br>可以发现这个可以直接把组合数拆开变成幂。</p>
<p>实际上那个 $\sum\limits_{i=1}^n$ 有一些项应该是不能算的，因为组合数其实等于 $0$。<br>所以根据 $(a+b)^n$ 的系数其实就是组合数，可以直接代进去。</p>
<p>即 $(a+b)^n=\sum\limits_{i=0}^n\binom{n}{i}a^{n-i}b^i$。</p>
<p>应该长成这样吧，不太确定有没有问题。</p>
<p>所以又可以化简成下面那样。</p>
<p>$$=(n-1)(s+1)^{n-2}+(s+1)^{n-1}$$<br>$$=(s+1)^{n-2}(s+1+n-1)$$<br>$$=(s+1)^{n-2}(s+n)$$</p>
<p>然后就可以代回去了。</p>
<p>$$p=\sum\limits_{j=0}^{k-1}\dfrac{(-1)^j}{j!\times(k-j-1)!}[(n-1)(k-j)^{n-2}+(k-j)^{n-1}]$$<br>$$=\sum\limits_{j=0}^{k-1}\dfrac{(-1)^j}{j!\times(k-j-1)!}(k-j)^{n-2}(n+k-j-1)$$</p>
<p>所以就可以得出代码了。<br>我的时间复杂度比较劣，代码还是参考别人的吧。</p>
<p>时间复杂度 $\Theta(k \log \text{Mod})$。</p>
<p>不要问我为什么后面是 $\text{Mod}$ 而不是 $n$（<br>问就是逆元没有线性求，直接 <code>qpow(x,mod-2)</code>（（（</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> n, k, cnt, sum, a, jc[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  jc[<span class="number">0</span>] = jc[<span class="number">1</span>] = <span class="number">1ll</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>; i&lt;=k; ++i)</span><br><span class="line">    jc[i] = jc[i<span class="number">-1</span>] * i % MOD;</span><br><span class="line">    <span class="comment">// 预处理阶乘</span></span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> bas, <span class="keyword">int</span> pw)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> mult = <span class="number">1ll</span>;</span><br><span class="line">  <span class="keyword">while</span> (pw) &#123;</span><br><span class="line">    <span class="keyword">if</span> (pw &amp; <span class="number">1ll</span>) mult = mult * bas % MOD;</span><br><span class="line">    bas = bas * bas % MOD;</span><br><span class="line">    pw /= <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 貌似是个 UB，不能写 &gt;&gt;=1ll</span></span><br><span class="line">  &#125; <span class="keyword">return</span> mult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">inv</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">qpow</span>(x, MOD<span class="number">-2</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//   freopen(&quot;sum.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">  <span class="comment">// freopen(&quot;sum.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;n, &amp;k); <span class="built_in">init</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;a), cnt = (cnt + a) % MOD;</span><br><span class="line">  <span class="keyword">int</span> Sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;k; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = <span class="built_in">inv</span>(jc[i]);</span><br><span class="line">    cur = cur * <span class="built_in">inv</span>(jc[k-i<span class="number">-1</span>]) % MOD;</span><br><span class="line">    <span class="keyword">int</span> f = i&amp;<span class="number">1</span>? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">    cur = f * cur % MOD, cur = (cur % MOD + MOD) % MOD;</span><br><span class="line">    cur = cur * <span class="built_in">qpow</span>(k-i, n<span class="number">-2</span>) % MOD;</span><br><span class="line">    cur = cur * (n+k-i<span class="number">-1</span>) % MOD;</span><br><span class="line">    Sum = (Sum + cur) % MOD;</span><br><span class="line">    <span class="comment">// 对于分母求逆元再乘分子，基本操作</span></span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; Sum * cnt % MOD &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/04/P2150-Solution/"><img class="fill" src="https://tva4.sinaimg.cn/large/87c01ec7gy1fsnqr17s46j21kw0w0tqs.jpg" alt="P2150 Solution"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-04T01:13:40.000Z" title="2021/8/4 上午9:13:40">2021-08-04</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-08-05T06:47:32.329Z" title="2021/8/5 下午2:47:32">2021-08-05</time></span><span class="level-item"><a class="link-muted" href="/categories/Sol/">Sol</a></span><span class="level-item">9 minutes read (About 1326 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/04/P2150-Solution/">P2150 Solution</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2150">P2150 寿司晚宴</a></li>
</ul>
<h3 id="Simplification-for-the-Question"><a href="#Simplification-for-the-Question" class="headerlink" title="Simplification for the Question"></a>Simplification for the Question</h3><ul>
<li>有 $[2,n]$ 总共 $n-1$ 个数。</li>
<li>从中挑选一些不重复的数字（可以不全选），组成集合 $S$ 和 $T$。</li>
<li>求使得 $\forall x \in S,y \in T,\gcd(x,y)=1$ 的方案总数。</li>
</ul>
<hr>
<h2 id="Part-1-30pts-Algorithm"><a href="#Part-1-30pts-Algorithm" class="headerlink" title="Part 1 - 30pts Algorithm"></a>Part 1 - 30pts Algorithm</h2><p>首先看到最简单的 30pts 算法，最暴力的部分总能给我们启示。</p>
<p>对于这 30pts，观察到 $n \le 30$。</p>
<p>那么这意味着什么呢？对，就是暴力。</p>
<p>首先看到 $\gcd$，求最大公约数，由唯一分解定理可知每一个数都可以由若干质数或质数的幂的连乘积构成，那么显然问题转化为：求使得 $\forall x\in S,y \in T$，设 $x$ 包含的质数集合为 $P$，设 $y$ 包含的质数集合为 $P’$，有 $P∩P’=\varnothing$，像这样的方案总数。</p>
<p>由于一个数的整数因数一定 $\le$ 它本身，所以说最大的质数一定 $\le n$，即 $p \le n \le 30$。<br>其中 $p$ 表示当前情况的质数集合。</p>
<p>很显然，经过枚举，我们发现 $30$ 以内有 $10$ 个质数（</p>
<p>所以直接暴力状压 DP，将质数的包含情况作为状态，包含为 $1$，否则为 $0$。</p>
<p>那么这个就是 30pts 的暴力算法了，时间复杂度 $\Theta(2^{2p}N)$，其中 $p$ 为质数个数。</p>
<hr>
<h2 id="Part-2-pts-Algorithm"><a href="#Part-2-pts-Algorithm" class="headerlink" title="Part 2 - ? pts Algorithm"></a>Part 2 - ? pts Algorithm</h2><p>我也不知道中间那两档分是用来干什么的。<br>所以直接看正解算了吧。/kel</p>
<hr>
<h2 id="Part-3-100pts-Algorithm"><a href="#Part-3-100pts-Algorithm" class="headerlink" title="Part 3 - 100pts Algorithm"></a>Part 3 - 100pts Algorithm</h2><p>首先我们判一个数是否是质数，最暴力的是这样判的。</p>
<ul>
<li>试除法</li>
</ul>
<p>大概就长这样</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">function</span> (<span class="keyword">int</span> n)</span><br><span class="line"><span class="keyword">if</span> n:<span class="number">0</span> / n:<span class="number">1</span> -&gt; <span class="built_in">back</span>(<span class="number">0</span>)</span><br><span class="line"><span class="function"><span class="keyword">for</span> i in <span class="title">range</span><span class="params">(<span class="number">2</span>,sqrt(n))</span></span></span><br><span class="line"><span class="function">  <span class="keyword">if</span> !<span class="params">(n mod i)</span> -&gt; <span class="title">back</span><span class="params">(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">back</span><span class="params">(<span class="number">1</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>那么看到这个 $\sqrt{n}$，这个就是解题的重点。</p>
<p>首先 $\sqrt{n} \times \sqrt{n}=n$。</p>
<p>接着，分两种情况讨论质数 $p$。</p>
<ul>
<li>$p\ge\sqrt{n}$</li>
</ul>
<p>那么设 $p \times k=n$，则显然 $k \le \sqrt{n}$。</p>
<p>又因为因数不大于这个数本身，所以 $\ge\sqrt{n}$ 的数最多只有两个，即 $&gt;\sqrt{n}$ 的数最多只有一个。</p>
<ul>
<li>$p&lt;\sqrt{n}$</li>
</ul>
<p>这个不用讲了吧。</p>
<p>那么又看到我们之前的暴力。</p>
<p>我们搞暴力，就是处理 $20$ 以内的质数。</p>
<p>但是现在我们发现 $&gt;\sqrt{n}$ 的数最多只有一个，那么只要处理 $\le \sqrt{n}$ 的数，并且新开一个记录这个 $&gt;\sqrt{n}$ 的数即可。</p>
<p>然后我们又看到 $n \le 500$。</p>
<p>而 $\sqrt{500}=22.360679775…$</p>
<p>所以说这个暴力就是个铺垫嘛，处理 $22$ 反而只有八个质数。</p>
<p>所以我们就想到了正解，也就是，同样枚举八个质数的情况，然后再根据大质数来判断是否可选即可。</p>
<p>但是我们怎么能保证大质数呢？</p>
<p>很显然，直接大质数从小到大结构体排个序即可。<br>然后对于两个人取的 DP 数，直接暴力处理然后合并即可。</p>
<p>注意合并的时候要容斥，因为统计会同时处理两个人都不选的情况，所以在合并的时候要减掉一个原来的数值。</p>
<p>恭喜你，你又 A 掉了一道黑题。</p>
<p>时间复杂度优化为恒定 $\Theta(2^{16}N)$</p>
<p>其中有一个地方要注意一下，就是在判断一开始预处理的质数情况时，贡献一定要加到对面去而不是自己的地方，因为如果加到自己的地方，无法保证对面和自己没有重复的元素，但是因为我们已经判断过这个质数和自己的关系，所以即使这个质数情况与对面有重复，加到一起仍然与自己合法，因为一定不会有重复的地方。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ri register int</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e2</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">1</span>&lt;&lt;<span class="number">8</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> pr[<span class="number">8</span>] = &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> n, Mod, dp[M][M];</span><br><span class="line"><span class="keyword">int</span> Mer1[M][M], Mer2[M][M];</span><br><span class="line"><span class="comment">// Merge after dealing with, to DP</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;ret)</span> </span>&#123;</span><br><span class="line">  ret = <span class="number">0</span>; <span class="keyword">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) ch = <span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">    ret = (ret&lt;&lt;<span class="number">1</span>) + (ret&lt;&lt;<span class="number">3</span>) + (ch^<span class="number">48</span>);</span><br><span class="line">    ch = <span class="built_in">getchar</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Number</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> value;</span><br><span class="line">  <span class="keyword">int</span> MaxiPrime;</span><br><span class="line">  <span class="keyword">int</span> OtherPrime;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dealwith</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// deal with possible primes</span></span><br><span class="line">    <span class="keyword">int</span> cur = value;</span><br><span class="line">    <span class="keyword">for</span> (ri i=<span class="number">0</span>; i&lt;<span class="number">8</span>; ++i) &#123;</span><br><span class="line">      <span class="comment">// choose the primes</span></span><br><span class="line">      <span class="keyword">if</span> (cur % pr[i]) <span class="keyword">continue</span>;</span><br><span class="line">      <span class="comment">// can&#x27;t be devided with no left</span></span><br><span class="line">      OtherPrime |= (<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">      <span class="keyword">while</span> (!(cur % pr[i])) cur /= pr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cur &gt; <span class="number">1</span>) MaxiPrime = cur;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> Number &amp;X) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> MaxiPrime &lt; X.MaxiPrime;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">read</span>(n), <span class="built_in">read</span>(Mod);</span><br><span class="line">  <span class="keyword">for</span> (ri i=<span class="number">2</span>; i&lt;=n; ++i)</span><br><span class="line">    a[i<span class="number">-1</span>].value = i, a[i<span class="number">-1</span>].<span class="built_in">dealwith</span>();</span><br><span class="line">  <span class="built_in">sort</span>(a+<span class="number">1</span>, a+n), dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Merge</span><span class="params">(ri &amp;x, ri y)</span> </span>&#123;</span><br><span class="line">  x = (x + y) % Mod;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">init</span>();</span><br><span class="line">  <span class="comment">// predict:</span></span><br><span class="line">    <span class="comment">// Rolling Array, Back-to-Head Scan!</span></span><br><span class="line">  <span class="keyword">for</span> (ri i=<span class="number">1</span>; i&lt;n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">1</span> || a[i].MaxiPrime ^ a[i<span class="number">-1</span>].MaxiPrime || !a[i].MaxiPrime)</span><br><span class="line">      <span class="built_in">memcpy</span>(Mer1, dp, <span class="keyword">sizeof</span> Mer1),</span><br><span class="line">      <span class="built_in">memcpy</span>(Mer2, dp, <span class="keyword">sizeof</span> Mer2);</span><br><span class="line">    <span class="comment">// just copy from dp to Merge</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ri j=M<span class="number">-1</span>; j&gt;=<span class="number">0</span>; --j)</span><br><span class="line">      <span class="keyword">for</span> (ri k=M<span class="number">-1</span>; k&gt;=<span class="number">0</span>; --k) &#123;</span><br><span class="line">        <span class="comment">// enumarate each possible situation</span></span><br><span class="line">        <span class="comment">// which is of the two people</span></span><br><span class="line">        <span class="keyword">if</span> (j&amp;k) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">// has the same elements</span></span><br><span class="line">        <span class="keyword">if</span> (!(j&amp;a[i].OtherPrime))</span><br><span class="line">          <span class="built_in">Merge</span>(Mer1[j][k|a[i].OtherPrime], Mer1[j][k]);</span><br><span class="line">        <span class="keyword">if</span> (!(k&amp;a[i].OtherPrime))</span><br><span class="line">          <span class="built_in">Merge</span>(Mer2[j|a[i].OtherPrime][k], Mer2[j][k]);</span><br><span class="line">          # 需要注意的就是这里，不要写反了</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (i == n<span class="number">-1</span> || a[i].MaxiPrime ^ a[i+<span class="number">1</span>].MaxiPrime || !a[i].MaxiPrime)</span><br><span class="line">      <span class="keyword">for</span> (ri j=<span class="number">0</span>; j&lt;M; ++j)</span><br><span class="line">        <span class="keyword">for</span> (ri k=<span class="number">0</span>; k&lt;M; ++k) &#123;</span><br><span class="line">          <span class="keyword">if</span> (j&amp;k) <span class="keyword">continue</span>;</span><br><span class="line">          <span class="comment">// has the same elements</span></span><br><span class="line">          ri to = Mer1[j][k] + Mer2[j][k] - dp[j][k];</span><br><span class="line">          to %= Mod, dp[j][k] = to;</span><br><span class="line">          dp[j][k] = (dp[j][k] + Mod) % Mod;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ri ans = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (ri i=<span class="number">0</span>; i&lt;M; ++i)</span><br><span class="line">    <span class="keyword">for</span> (ri j=<span class="number">0</span>; j&lt;M; ++j)</span><br><span class="line">      <span class="keyword">if</span> (!(i&amp;j)) <span class="built_in">Merge</span>(ans, dp[i][j]);</span><br><span class="line">  cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/08/03/System-of-Difference-Constraints/"><img class="fill" src="https://tva3.sinaimg.cn/large/87c01ec7gy1fsnqqlxbtmj21kw0w0aoq.jpg" alt="差分约束专题"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-03T14:34:50.000Z" title="2021/8/3 下午10:34:50">2021-08-03</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-09-04T15:07:19.268Z" title="2021/9/4 下午11:07:19">2021-09-04</time></span><span class="level-item"><a class="link-muted" href="/categories/Notes/">Notes</a></span><span class="level-item">2 minutes read (About 371 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/03/System-of-Difference-Constraints/">差分约束专题</a></h1><div class="content"><ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5960">P5960 差分约束算法</a></li>
</ul>
<p>显然题。</p>
<p>首先有 $x_{c1}-x_{c1’} \le y_1$。<br>那么有 $x_{c1} \le x_{c1’} + y_1$。<br>所以看到图论里面的松弛操作，即最终使得 <code>dist[to]&lt;=dist[cur]+e[i].val</code>。</p>
<p>要使得这个成立所以要跑一遍最短路。</p>
<p>那么将 $x$ 视为 <code>dist</code>，<code>c1</code> 视为 <code>to</code>，<code>c1&#39;</code> 视为 <code>cur</code> 即可。</p>
<p>然后因为跑最短路的 dijkstra 需要源点，即单源最短路径。<br>所以直接造一个源点就可以跑了，并没有什么实际作用（</p>
<p>判负环似乎只需要加上一个统计入队次数的 cnt 即可。<br>因为显然，有负环就没有合法解。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e3</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, cnt; <span class="keyword">bool</span> inq[N];</span><br><span class="line"><span class="keyword">int</span> head[N&lt;&lt;<span class="number">1</span>], dist[N], vis[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to, nxt, val;</span><br><span class="line">&#125; e[N&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">  e[++cnt].to = v;</span><br><span class="line">  e[cnt].nxt = head[u];</span><br><span class="line">  e[cnt].val = w; head[u] = cnt;</span><br><span class="line">  <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">spfa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  queue &lt;<span class="keyword">int</span>&gt; sp; sp.<span class="built_in">push</span>(<span class="number">0</span>);</span><br><span class="line">  vis[<span class="number">0</span>] = <span class="number">1</span>, inq[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">  <span class="built_in">memset</span>(dist, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> dist);</span><br><span class="line">  dist[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (!sp.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">int</span> cur = sp.<span class="built_in">front</span>(); sp.<span class="built_in">pop</span>();</span><br><span class="line">    inq[cur] = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=head[cur]; ~i; i=e[i].nxt) &#123;</span><br><span class="line">      <span class="keyword">int</span> to = e[i].to;</span><br><span class="line">      <span class="keyword">if</span> (dist[to] &gt; dist[cur]+e[i].val) &#123;</span><br><span class="line">        dist[to] = dist[cur] + e[i].val;</span><br><span class="line">        <span class="keyword">if</span> (!inq[to]) &#123;</span><br><span class="line">          inq[to] = <span class="literal">true</span>, sp.<span class="built_in">push</span>(to);</span><br><span class="line">          ++vis[to]; <span class="keyword">if</span> (vis[to]&gt;n) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head);</span><br><span class="line">  cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> u, v, w; cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;</span><br><span class="line">    <span class="built_in">addEdge</span>(v, u, w);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) <span class="built_in">addEdge</span>(<span class="number">0</span>, i, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">spfa</span>()) &#123; <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>); <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) cout &lt;&lt; dist[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">Previous</a></div><div class="pagination-next"><a href="/page/2/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://z3.ax1x.com/2021/08/22/hSpNkV.png" alt="Xcel"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Xcel</p><p class="is-size-6 is-block">Believe in Miracles!</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Changsha, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">7</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/lbn233" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/lbn233"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com/MizuQ"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/C5H8N4O12"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.luogu.com.cn/user/487752" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">My Luogu</span></span><span class="level-right"><span class="level-item tag">www.luogu.com.cn</span></span></a></li><li><a class="level is-mobile" href="https://blog.calvincheng1231.org.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Calvin&#039;s Blog</span></span><span class="level-right"><span class="level-item tag">blog.calvincheng1231.org.cn</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Notes/"><span class="level-start"><span class="level-item">Notes</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Sol/"><span class="level-start"><span class="level-item">Sol</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-04T14:30:18.000Z">2021-09-04</time></p><p class="title"><a href="/2021/09/04/Persistence-Data-Structure/">可持久化数据结构</a></p><p class="categories"><a href="/categories/Notes/">Notes</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-31T07:47:49.000Z">2021-08-31</time></p><p class="title"><a href="/2021/08/31/FFT-and-NTT/">关于 FFT 和 NTT 等多项式科技的学习</a></p><p class="categories"><a href="/categories/Notes/">Notes</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-20T14:01:21.000Z">2021-08-20</time></p><p class="title"><a href="/2021/08/20/Kachang-Skills/">一些卡常的小技巧</a></p><p class="categories"><a href="/categories/Notes/">Notes</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-12T23:55:14.000Z">2021-08-13</time></p><p class="title"><a href="/2021/08/13/Dyncmic-Tree-Devide/">咕咕咕的动态淀粉质</a></p><p class="categories"><a href="/categories/Notes/">Notes</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-08-09T14:01:53.000Z">2021-08-09</time></p><p class="title"><a href="/2021/08/09/About-Duliu-DS/">比较纯粹的分块线段树等 DS 趣题</a></p><p class="categories"><a href="/categories/Notes/">Notes</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">September 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/DS/"><span class="tag">DS</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Graph/"><span class="tag">Graph</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Math/"><span class="tag">Math</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Network-Flows/"><span class="tag">Network Flows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Number-Theory/"><span class="tag">Number Theory</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Others/"><span class="tag">Others</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/State-Compression/"><span class="tag">State Compression</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Xcel&#039;s Little House</a><p class="is-size-7"><span>&copy; 2021 Xcel</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'folded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>